

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linux shell tutorial documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="aaltoscicomp.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="#" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Linux shell tutorial
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PART #1. Linux shell basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-the-shell">Basic shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-starting-commands">Starting out</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-processes">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-files-and-directories">Files and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-find">Find</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-file-archive-transfer">File archiving and transferring</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-cli_utiltities">Command line utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-pipelines-grep">Evaluations, separators and grep</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-init_files">Initialization files and file editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-hotkeys">How to make things faster: hotkeys</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PART #2. Linux shell scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-quoting-substitution-aliases">Quoting, substitutions, aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-variables-functions-environments">Variables, functions, environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-conditionals">Conditionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-loops">Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-arrays-inputs-here-documents">Arrays, input, Here Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-traps-debugging-profiling">Traps, debugging, profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-parallel-crontab-perlawksed">Parallel, crontab, perl/awk/sed</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-contact">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-about">About us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-to-continue">To continue: course development ideas/topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-bonus-material">Bonus material</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-guide">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Linux shell tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Linux shell tutorial  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/content/blob/main/content/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="linux-shell-tutorial">
<h1>Linux shell tutorial<a class="headerlink" href="#linux-shell-tutorial" title="Link to this heading"></a></h1>
<p>Linux Shell tutorial by Science IT at Aalto University.</p>
<p>This course consists of two parts: Linux Shell Basics and Linux Shell Scripting. The first one
covers introductory level shell usage (which also is a backdoor introduction to Linux basics).
The second one covers actual BASH scripting, using learning by doing.</p>
<p>Starred exercises (*) are for advanced users who would like further stimulation.</p>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Part #1: A Linux/Mac computer or a Windows with SSH client installed to access any Linux server</p></li>
<li><p>Part #2: Shell basics, know how to create a directory and edit a file from command line</p></li>
</ul>
</div>
<section id="who-is-the-course-for">
<h2>Who is the course for?<a class="headerlink" href="#who-is-the-course-for" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Part #1 for those who need a comprehensive dive into shell basics.</p></li>
<li><p>Part #2 for people with intermediate/advanced level of Linux/Mac shell</p></li>
</ul>
</section>
<section id="schedule">
<h2>Schedule<a class="headerlink" href="#schedule" title="Link to this heading"></a></h2>
<p>Ongoing. Optional lectures on average once per year with following timetable:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Linux Shell Basics</p></td>
<td><p>3 sessions x 3h</p></td>
</tr>
<tr class="row-even"><td><p>Linux Shell Scripting</p></td>
<td><p>4 sessions x 3h</p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Based on</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">bash</span></code> v4.2 (Triton default version in Feb 2018)</p></li>
<li><p><a class="reference external" href="http://tldp.org/LDP/abs/html/index.html">Advanced BASH scripting guide</a></p></li>
<li><p>UNIX Power Tools, Shelley Powers etc, 3rd ed, O’Reilly</p></li>
<li><p>common sense and 20+ years Linux experience</p></li>
<li><p>see also other references in the text</p></li>
</ul>
</dd>
</dl>
</section>
<section id="videos">
<h2>Videos<a class="headerlink" href="#videos" title="Link to this heading"></a></h2>
<p>Videos of previous instances:</p>
<ul class="simple">
<li><p>Part 1, 2023: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nPRb-QjrWsg_fTUfJ5Bbv07">Playlist</a></p></li>
<li><p>Part 2, 2024: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nOXyXh0TEgGhS7bUdOT0dGg">Playlist</a></p></li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-the-shell"></span><section id="basic-shell">
<h3>Basic shell<a class="headerlink" href="#basic-shell" title="Link to this heading"></a></h3>
<section id="first-touch-getting-a-bash-shell">
<h4>First touch: getting a BASH shell<a class="headerlink" href="#first-touch-getting-a-bash-shell" title="Link to this heading"></a></h4>
<p>Set yourself up with a BASH shell.  Connect to a server or open on your own computer.
Examples and demos given during the lecture are done on a native Linux BASH on either Ubuntu or CentOS,
though should work on all other Linux installations and Git BASH on Windows.</p>
<ul>
<li><p>Linux and Mac users: just open a terminal window</p>
<blockquote>
<div><ul class="simple">
<li><p>Ubuntu users hint: Ctrl + Alt + t</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Windows users:</p>
<blockquote>
<div><ul class="simple">
<li><p>(Priority #1) SSH to a remote native Linux installation. For aalto users <a class="footnote-reference brackets" href="#aaltoremoteaccess" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<ul>
<li><p>Use built-in SSH client: open a Command Prompt (cmd) and launch a command ‘ssh <a class="reference external" href="mailto:loginname&#37;&#52;&#48;remote&#46;server&#46;name">loginname<span>&#64;</span>remote<span>&#46;</span>server<span>&#46;</span>name</a>’</p></li>
<li><p>If no built-in client, install PuTTY <a class="footnote-reference brackets" href="#putty" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</li>
<li><p>(For easy testing) Git BASH <a class="footnote-reference brackets" href="#gitbash" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>  // Misses man pages, some utilities.</p></li>
<li><p>-or- VDI if such service available. Aalto user, see Remote desktop at <a class="footnote-reference brackets" href="#aaltoremoteaccess" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p></li>
<li><p>-or- Windows Subsystem for Linux (WSL 2) and Ubuntu on Windows <a class="footnote-reference brackets" href="#ubuntuwindows" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p></li>
<li><p>-or- Cygwin <a class="footnote-reference brackets" href="#cygwin" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="about-the-linux-shell">
<h4>About the Linux Shell<a class="headerlink" href="#about-the-linux-shell" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>A <em>shell</em> is what you get when your terminal window is open. It is a
command-line (CLI), an interface that interpreters and executes the
commands.</p></li>
<li><p>The name comes from being a “shell” (layer) around the operating
system.  It connects and binds all programs together.</p></li>
<li><p>This is the basic, raw method of using UNIX-like systems.  It may
not be used everyday, but it’s really good (necessary) for any type
of automation and scripting - as is often needed in science, when
connecting pieces together, or when using Triton.</p></li>
<li><p>There are multiple shells.  This talk is about <a class="reference external" href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a>, which is the
most common one.  <a class="reference external" href="https://en.wikipedia.org/wiki/Z_shell">zsh</a> is
another common shell which is somewhat similar but has some more
powerful features.  <a class="reference external" href="https://en.wikipedia.org/wiki/Tcsh">tcsh</a> is
another shell from a completely different family (the csh family),
which has quite different syntax.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bash</span></code> is a “Bourne shell”: the “bourne-again shell”.  An open source
version of original Bourne shell.</p></li>
<li><p>It may not be obvious, but the concepts here also apply to Windows
programs and will help you understand them.  They also apply more
directly to Mac programs, because Mac is unix under the hood.</p></li>
</ul>
</section>
<section id="basic-shell-operation">
<h4>Basic shell operation<a class="headerlink" href="#basic-shell-operation" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>You type things on the screen (standard input or stdin).  The shell
uses this to make a command.</p></li>
<li><p>The shell takes the command, splits it into words, does a lot more
preprocessing, and then runs it.</p></li>
<li><p>When the command runs, the keyboard (still standard input) goes to
the process, output (standard output) goes to the screen.</p></li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="aaltoremoteaccess" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id4">2</a>)</span>
<p><a class="reference external" href="https://scicomp.aalto.fi/aalto/remoteaccess/">https://scicomp.aalto.fi/aalto/remoteaccess/</a></p>
</aside>
<aside class="footnote brackets" id="putty" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a></p>
</aside>
<aside class="footnote brackets" id="gitbash" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://gitforwindows.org/">https://gitforwindows.org/</a></p>
</aside>
<aside class="footnote brackets" id="ubuntuwindows" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.microsoft.com/en-us/p/ubuntu/9nblggh4msv6">https://www.microsoft.com/en-us/p/ubuntu/9nblggh4msv6</a></p>
</aside>
<aside class="footnote brackets" id="cygwin" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.cygwin.com/">https://www.cygwin.com/</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-starting-commands"></span><section id="starting-out">
<h3>Starting out<a class="headerlink" href="#starting-out" title="Link to this heading"></a></h3>
<section id="starter">
<h4>Starter<a class="headerlink" href="#starter" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>du -hs * .[!.]* | sort -h
tar czf - $d | ssh kosh.aalto.fi &#39;cat &gt; public_html/$d.tar.gz &amp;&amp; chmod a+r $d.tar.gz&#39;
find $d -type f \( ! -perm /g+w  -o -perm /o+w \) -exec chmod u+rwX,g+rwX,o-wx {} \;
</pre></div>
</div>
</section>
<section id="a-minimum-to-get-started">
<h4>A minimum to get started<a class="headerlink" href="#a-minimum-to-get-started" title="Link to this heading"></a></h4>
<p>Try them right away:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>whoami (-or- id)
echo $SHELL
uname -a (-or- hostnamectl if available)
pwd
ls -lA
cd
date
grep searchword filename
cat filename
</pre></div>
</div>
<p>In combination with opeators <em>&gt;</em> and <em>|</em> serves, plus text editor and a viewer
like <em>less</em>, you should feel yourself safe already now.</p>
<p>For Aalto users: is your default shell a <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code>? Login to kosh/taltta and run <code class="docutils literal notranslate"><span class="pre">chsh</span> <span class="pre">-s</span> <span class="pre">/bin/bash</span></code></p>
</section>
<section id="getting-help-in-terminal">
<h4>Getting help in terminal<a class="headerlink" href="#getting-help-in-terminal" title="Link to this heading"></a></h4>
<p>Before you Google for the command examples, try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="n">command_name</span>
</pre></div>
</div>
<p>Your best friend ever – <code class="docutils literal notranslate"><span class="pre">man</span></code> – collection of manuals. Type
<em>/search_word</em> for searching through the man page, navigating between matches with <em>n</em>
and <em>shift + n</em>, <em>q</em> for the exit.</p>
<p>Additionally, many, but not all, commands have a usage summary if run with <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">--help</span></code>
or <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">-h</span></code> options.</p>
</section>
<section id="file-viewing-editing">
<h4>File viewing / editing<a class="headerlink" href="#file-viewing-editing" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">filename</span>
<span class="n">less</span> <span class="n">filename</span>  <span class="c1"># &#39;q&#39; to exit</span>
<span class="n">nano</span> <span class="n">filename</span>  <span class="c1"># Ctrl-x to exit</span>
</pre></div>
</div>
</section>
<section id="the-most-common-commands">
<h4>The most common commands<a class="headerlink" href="#the-most-common-commands" title="Link to this heading"></a></h4>
<p>The ones we use in this tutorial, subjective:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">echo</span><span class="p">,</span> <span class="n">whoami</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">jobs</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">less</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">kill</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">pgrep</span><span class="p">,</span>
<span class="n">pstree</span><span class="p">,</span> <span class="n">htop</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">touch</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">find</span><span class="p">,</span> <span class="n">rsync</span><span class="p">,</span> <span class="n">tar</span><span class="p">,</span> <span class="n">scp</span><span class="p">,</span> <span class="n">ssh</span><span class="p">,</span>
<span class="n">alias</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="n">umask</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">clear</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">grep</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">uniq</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">killall</span><span class="p">,</span>
<span class="n">gzip</span><span class="p">,</span> <span class="n">nano</span><span class="p">,</span> <span class="n">xargs</span><span class="p">,</span> <span class="n">chown</span><span class="p">,</span> <span class="n">chmod</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">sudo</span><span class="p">,</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">ping</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>Plus shell programming language constructs adn control operators.</p>
<p>Important remark: not all of the external commands are available on all the systems. Even Linux
distribution bundles may differ not speaking of the macOS setup and MS Windows packages.</p>
<p><strong>Hint</strong> <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">-a</span></code> to find binary location on the filesystem.</p>
</section>
<section id="built-in-and-external-commands">
<h4>(*) Built-in and external commands<a class="headerlink" href="#built-in-and-external-commands" title="Link to this heading"></a></h4>
<p>There are two types of commands:</p>
<ul class="simple">
<li><p>shell built-in: <code class="docutils literal notranslate"><span class="pre">cd</span></code>, <code class="docutils literal notranslate"><span class="pre">pwd</span></code>, <code class="docutils literal notranslate"><span class="pre">echo</span></code>, <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">bg</span></code>, <code class="docutils literal notranslate"><span class="pre">set</span></code>, <code class="docutils literal notranslate"><span class="pre">umask</span></code> etc.</p></li>
<li><p>external: <code class="docutils literal notranslate"><span class="pre">ls</span></code>, <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">less</span></code>, <code class="docutils literal notranslate"><span class="pre">lpr</span></code>, <code class="docutils literal notranslate"><span class="pre">cat</span></code>, etc.</p></li>
<li><p>some can be both: e.g. <code class="docutils literal notranslate"><span class="pre">echo</span></code>.  Options not always the same!</p></li>
<li><p>For the most part, these behave similarly, which is a good thing!
You don’t have to tell which is which.</p></li>
<li><p><strong>echo</strong>: prints out <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">something</span> <span class="pre">to</span> <span class="pre">type</span></code> # types whatever you put after</p></li>
</ul>
<p><strong>Disable built-in command</strong> <code class="docutils literal notranslate"><span class="pre">enable</span> <span class="pre">-n</span> <span class="pre">echo</span></code>, after this <em>/usr/bin/echo</em>
becomes a default instead of built-in <em>echo</em></p>
</section>
</section>
<span id="document-processes"></span><section id="processes">
<h3>Processes<a class="headerlink" href="#processes" title="Link to this heading"></a></h3>
<section id="what-s-a-unix-process">
<h4>What’s a UNIX process?<a class="headerlink" href="#what-s-a-unix-process" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>To understand a shell, let’s first understand what processes are.</p></li>
<li><p>All programs are a process: process is a program in action.</p></li>
<li><p>Processes have:</p>
<ul>
<li><p>Process ID or PID (integer)</p></li>
<li><p>Name (command being run)</p></li>
<li><p>Command line arguments/options</p></li>
<li><p>input and output: <code class="docutils literal notranslate"><span class="pre">stdin</span></code> (input, like from keyboard, another program, another device),
<code class="docutils literal notranslate"><span class="pre">stdout</span></code> (output, like to screen, another program, file, device), <code class="docutils literal notranslate"><span class="pre">stderr</span></code> (like stdout but for errors)</p></li>
<li><p>Return code (integer) when complete</p></li>
<li><p>Working directory</p></li>
<li><p>environment variables: key-values which get inherited across processes.</p></li>
</ul>
</li>
<li><p>These concepts bind together <em>all</em> UNIX programs, even graphical ones.</p></li>
</ul>
<p>Process listing commands (feel free to try, but we play more with them later):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ps auxw
top              # (q to quit)
htop             # (q to quit)
pstree
pstree $USER
pstree -pau $USER
</pre></div>
</div>
<p>Another way to find out what SHELL you are running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ps -p $$
</pre></div>
</div>
</section>
<section id="working-with-processes">
<h4>Working with processes<a class="headerlink" href="#working-with-processes" title="Link to this heading"></a></h4>
<p>All processes are related, a command executed in shell is a child process of
the shell. When child process is terminated it is reported back to parent process.
When you log out all shell child processes terminated along with the
shell.  You can see the whole family tree with <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">af</span></code>.
One can kill a process or make it “nicer”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgrep</span> <span class="o">-</span><span class="n">af</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">kill</span> <span class="o">&lt;</span><span class="n">PID</span><span class="o">&gt;</span>
<span class="n">pkill</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">renice</span> <span class="c1">#priority &lt;PID&gt;</span>
</pre></div>
</div>
<p>Making process “nicer”, <code class="docutils literal notranslate"><span class="pre">renice</span> <span class="pre">19</span> <span class="pre">&lt;PID&gt;</span></code>, means it will run only when nothing
else in the system wants to.
User can increase nice value from 0 (the base priority) up to 19. It is
useful when you backup your data in background or alike.</p>
</section>
<section id="foreground-and-background-processes">
<h4>Foreground and background processes<a class="headerlink" href="#foreground-and-background-processes" title="Link to this heading"></a></h4>
<p>The shell has a concept of foreground and background processes: a
foreground process is directly connected to your screen and
keyboard. A background process doesn’t have input connected.  There
can only be one foreground at a time (obviously).</p>
<p>If you add <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> right after the command will send the process to
background. Example: <code class="docutils literal notranslate"><span class="pre">firefox</span> <span class="pre">--no-remote</span> <span class="pre">&amp;</span></code>, and same can be done with
any terminal command/function, like <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">pstree</span> <span class="pre">&amp;</span></code>.  In the big
picture, the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> serves the same role as <code class="docutils literal notranslate"><span class="pre">;</span></code> to separate commands,
but backgrounds the first and goes straight to the next.</p>
<p>If you have already running process, you can background with Ctrl-z and then
<code class="docutils literal notranslate"><span class="pre">bg</span></code>. Drawback: there is no easy way to redirect the running task
output, so if it generates output it covers your screen.</p>
<p>List the jobs running in the background with <code class="docutils literal notranslate"><span class="pre">jobs</span> <span class="pre">-l</span></code> (show real PID as well),
get a job back online with  <code class="docutils literal notranslate"><span class="pre">fg</span></code> or <code class="docutils literal notranslate"><span class="pre">fg</span> <span class="pre">&lt;job_number&gt;</span></code>. There can be multiple
background jobs.</p>
<p>Kill a foreground job: Ctrl-c</p>
<p><strong>Hint:</strong> For running X Window apps while you logged in from other
Linux / MacOS make sure you use <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-X</span> <span class="pre">...</span></code> to log in. For Windows users,
you need to install VcXsrv Windows X Server <a class="footnote-reference brackets" href="#vcxsrv" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> on your workstation.</p>
<p><strong>Hint:</strong> For immediate job-state change notifications, use <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">notify</span></code>. To automatically
stop background processes if they try writing to the screen <code class="docutils literal notranslate"><span class="pre">stty</span> <span class="pre">tostop</span></code></p>
</section>
<section id="exit-the-shell-and-screen-utility">
<h4>Exit the shell and ‘screen’ utility<a class="headerlink" href="#exit-the-shell-and-screen-utility" title="Link to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">logout</span></code> or Ctrl-d (if you don’t want Ctrl-d to quit, set <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">IGNOREEOF=1</span></code> in <em>.bashrc</em>).</p>
<p>Of course, quitting your shell is annoying, since you have to start
over.  Luckily there are programs so that you don’t have to do this.
In order to keep your sessions running while you logged out, you
should learn about the <code class="docutils literal notranslate"><span class="pre">screen</span></code> program.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">screen</span></code> to start a session</p></li>
<li><p><em>Ctrl-a d</em> to detach the session while you are connected</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-ls</span></code> to list currently running sessions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-rx</span> <span class="pre">&lt;session_id&gt;</span></code> to attach the session, one can use TAB for the autocompletion or skip the &lt;session_id&gt; if there is only one session running</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tmux</span></code> is a newer program with the same style.  It has some extra
features and some missing features still.</p></li>
</ul>
</div></blockquote>
<p>Some people have their <code class="docutils literal notranslate"><span class="pre">screen</span></code> open forever, which just keeps
running and never gets closed.  Wherever they are, they ssh in,
connect, and resume right where they left off.</p>
<p>Example: <code class="docutils literal notranslate"><span class="pre">irssi</span></code> on kosh / lyta</p>
</section>
<section id="exercises-1-1">
<h4>Exercises 1.1<a class="headerlink" href="#exercises-1-1" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Find out which shell you are running, your user name, hostname, system name. For Aalto users: set
your SHELL to BASH if you have not yet done so: <code class="docutils literal notranslate"><span class="pre">chsh</span> <span class="pre">-s</span> <span class="pre">/bin/bash</span></code> on kosh</p></li>
<li><p>Find out with <em>man</em> how to use <em>top</em> / <em>ps</em> to list all the running processes that belong to you
Tip: <em>top</em> has both command line options and hot keys.</p></li>
<li><p>Find your shell session’s PID, list the processes tree of all child processes that belong to
your current session, with the command line, PID, user</p></li>
<li><p>With pgrep list all bash processes, if you have SSH access, try both locally, and on a remote Linux server</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">filename</span></code>, send it to the background, and return back to the foreground``. Tip: quite <code class="docutils literal notranslate"><span class="pre">nano`</span> <span class="pre">with</span> <span class="pre">``Ctrl-x</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">htop</span></code>, send it to the backround, and then kill it with <code class="docutils literal notranslate"><span class="pre">kill</span></code>. Tip: one can
do it by background job number or by PID.</p></li>
<li><p>(*) Run <code class="docutils literal notranslate"><span class="pre">screen</span></code> session. Detach, close the seesion, open again and attach ‘screen’ back. Exit ‘screen’.</p></li>
<li><p>(*) Find out how to list a processes tree with <code class="docutils literal notranslate"><span class="pre">ps</span></code>, both
all processes and only your own (but all your processes, associated with all terminals)</p></li>
<li><p>(*) Try a use case: your current ssh session to a remote host “got stuck” and does not response. Open another
ssh session to the same remote host and kill the first one. Tip: <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$$</span></code> gives you current
bash PID.</p></li>
<li><p>(*) Get any X Window application (firefox, xterm, etc) to run on a remote Linux machine</p></li>
</ul>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="vcxsrv" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://sourceforge.net/projects/vcxsrv/">https://sourceforge.net/projects/vcxsrv/</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-files-and-directories"></span><section id="files-and-directories">
<h3>Files and directories<a class="headerlink" href="#files-and-directories" title="Link to this heading"></a></h3>
<p>Files contain data.  They have a name, permissions, owner
(user+group), contents, and some other metadata.</p>
<p>Filenames may contain any character except ‘/’, which is reseved as a separator between
directory and filenames. The special characters would require quotaion while dealing,
with such filenames, though it makes sence to avoid them anyway.</p>
<p>Path can be absolute, starts with ‘/’ or relative, that is related to the current directory.</p>
<p><code class="docutils literal notranslate"><span class="pre">ls</span></code> is the standard way of getting information about files. By default it lists
your current directory (i.e. <em>pwd</em>), but there are many options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># list directory content</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>

<span class="c1"># list directory files including dot files (i.e. hidden ones)</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">A</span> <span class="o">~/</span><span class="n">directory1</span>

<span class="c1"># list all files and directories using long format (permissions, timestamps, etc)</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">lA</span> <span class="o">../../</span><span class="n">directory2</span>
</pre></div>
</div>
<p>Special notations and expanssions in BASH, can be used with any command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./    stands for the current directory
../   parent directory
~     home directory
*     a wildcard, replaces any character(s) or none
?     only one character
[]    a group of characters, like [abc]
[!]   same as above but negated, i.e. all but those, like [!a-zA-Z]
{ab,cd,xyz}  expands by BASH as &#39;ab cd xyz&#39;
{0..9}      expands as &#39;0 1 2 3 4 5 6 7 8 9&#39;
</pre></div>
</div>
<p>For the quotation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> \
</pre></div>
</div>
<p>Quotation matters <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">'file</span> <span class="pre">name'</span></code> vs <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">file</span> <span class="pre">name</span></code> or <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;$USER&quot;</span></code> vs <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">'$USER'</span></code></p>
<p>BASH first expand the expanssions and substitute the wildcards, and then
execute the command. Could be as complex as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls -l ~/[!abc]???/dir{123,456}/filename*.{1..9}.txt
</pre></div>
</div>
<p>There are a variety of commands to manipulate files/directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">rm</span> <span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="n">touch</span>
</pre></div>
</div>
<p>For file/directory meta information or content type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="nb">type</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">cd</span></code> is a shell builtin which change’s the shell’s own
working directory.  This is the base from which all other commands
work: <code class="docutils literal notranslate"><span class="pre">ls</span></code> by default tells you the current directory.  <code class="docutils literal notranslate"><span class="pre">.</span></code> is the
current directory, <code class="docutils literal notranslate"><span class="pre">..</span></code> is the parent directory, <code class="docutils literal notranslate"><span class="pre">~</span></code> is your HOME.  This is
inherited to other commands you run. <code class="docutils literal notranslate"><span class="pre">cd</span></code> with no options drops your to your $HOME.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># copy a directory preserving all the metadata to two levels up</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">a</span> <span class="n">dir1</span><span class="o">/</span> <span class="o">../../</span>

<span class="c1"># move all files with the names like filename1.txt, filename_abc.txt etc to dir2/</span>
<span class="n">mv</span> <span class="n">filename</span><span class="o">*.</span><span class="n">txt</span> <span class="n">dir2</span><span class="o">/</span>

<span class="c1"># remove a directories/files in the current dir without asking for the confirmation</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">dir2</span><span class="o">/</span> <span class="n">dir1</span><span class="o">/</span> <span class="n">filename</span><span class="o">*</span>

<span class="c1"># create an empty file if doesn&#39;t exist or update its access/modification time</span>
<span class="n">touch</span> <span class="n">filename</span>

<span class="c1"># create several directories at once</span>
<span class="n">mkdir</span> <span class="n">dir3</span> <span class="n">dir4</span> <span class="n">dir5</span>
<span class="c1"># -or-</span>
<span class="n">mkdir</span> <span class="nb">dir</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>

<span class="c1"># make a link to a target file (hard link by default, -s for symlinks)</span>
<span class="n">ln</span> <span class="n">target_file</span> <span class="o">../</span><span class="n">link_name</span>
</pre></div>
</div>
<p><strong>Discover other ls features</strong> <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lX</span></code>, <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-ltr</span></code>, <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-Q</span></code></p>
<p>You may also find useful <code class="docutils literal notranslate"><span class="pre">rename</span></code> utility implemented by Larry Wall.</p>
<section id="file-directory-permissions">
<h4>File/directory permissions<a class="headerlink" href="#file-directory-permissions" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Permissions are one of the types of file metadata.</p></li>
<li><p>They tell you if you can <em>read</em> a file, <em>write</em> a file, and
<em>execute a file/list directory</em></p></li>
<li><p>Each of these for both <em>user</em>, <em>group</em>, and <em>others</em></p></li>
<li><p>Here is a typical permission bits for a file: <code class="docutils literal notranslate"><span class="pre">-rw-r--r--</span></code></p></li>
<li><p>In general, it is <code class="docutils literal notranslate"><span class="pre">rwxrwxrwx</span></code> – read, write, execute/search for
user, group, others respectively</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code> gives you details on files.</p></li>
</ul>
</section>
<section id="modifying-permissions-the-easy-part">
<h4>Modifying permissions: the easy part<a class="headerlink" href="#modifying-permissions-the-easy-part" title="Link to this heading"></a></h4>
<p>chmod/chown is what will work on all filesystems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">rwx</span><span class="p">,</span><span class="n">g</span><span class="o">-</span><span class="n">rwx</span><span class="p">,</span><span class="n">o</span><span class="o">-</span><span class="n">rwx</span> <span class="o">&lt;</span><span class="n">files</span><span class="o">&gt;</span>   <span class="c1"># u=user, g=group, o=others, a=all</span>
<span class="c1"># -or-</span>
<span class="n">chmod</span> <span class="mi">700</span> <span class="o">&lt;</span><span class="n">files</span><span class="o">&gt;</span>   <span class="c1"># r=4, w=2, x=1</span>

<span class="c1"># recursive, changing all the subdirectories and files at once</span>
<span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="n">perm</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">directory</span><span class="o">&gt;</span>

<span class="c1"># changing group ownership (you must be a group member)</span>
<span class="n">chgrp</span> <span class="n">group_name</span> <span class="o">&lt;</span><span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Extra permission bits:</p>
<ul class="simple">
<li><p>s-bit:  setuid/setgid bit, preserves user and/or group IDs.</p></li>
<li><p>t-bit: sticky bit, for directories it prevents from removing file by
another user (example <em>/tmp</em>)</p></li>
</ul>
<p>Setting default access permissions: add to <em>.bashrc</em> <code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">027</span></code>
<a class="footnote-reference brackets" href="#umask" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.  The <code class="docutils literal notranslate"><span class="pre">umask</span></code> is what permissions are <em>removed</em> from any newly
created file by default.  So <code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">027</span></code> means “by default,
g-w,o-rwx any newly created files”.  It’s not really changing the
permissions, just the default the operating system will create with.</p>
<p><strong>Hint:</strong>
even though file has a read access the top directory must be
searchable before external user or group will be able to access
it. Sometimes on Triton, people do <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">-R</span> <span class="pre">o-rwx</span> <span class="pre">$WRKDIR;</span> <span class="pre">chmod</span> <span class="pre">o+x</span>
<span class="pre">$WRKDIR</span></code>.  Execute (<code class="docutils literal notranslate"><span class="pre">x</span></code>) without read (<code class="docutils literal notranslate"><span class="pre">r</span></code>) means that you can
access files inside if you know the exact name, but not list the
directory.  The permissions of the files themselves still matter.</p>
</section>
<section id="modifying-permissions-advanced">
<h4>Modifying permissions: advanced (*)<a class="headerlink" href="#modifying-permissions-advanced" title="Link to this heading"></a></h4>
<p>Access Control Lists (ACLs) are advanced access permissions.  They
don’t work everywhere, for example mostly do no work on NFS
mounted directories.  They are otherwise supported on ext4, lustre,
etc (thus works on Triton $WRKDIR).</p>
<ul class="simple">
<li><p>In “normal” unix, files have only “owner” and “group”, and permissions
for owner/group/others.  This can be rather limiting.</p></li>
<li><p>Access control lists (ACLS) are an extension that allows an
arbitrary number of users and groups to have access rights to
files.  The basic concept is that you have:</p></li>
<li><p>ACLs don’t show up in normal <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code> output, but there is an extra
plus sign: <code class="docutils literal notranslate"><span class="pre">-rw-rwxr--+</span></code>.  ACLs generally work well, but there are
some programs that won’t preserve them when you copy/move files, etc.</p></li>
<li><p>POSIX (unx) ACLs are controlled with <code class="docutils literal notranslate"><span class="pre">getfacl</span></code> and <code class="docutils literal notranslate"><span class="pre">setfacl</span></code></p>
<ul>
<li><p>Allow read access for a user <code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">-m</span> <span class="pre">u:&lt;user&gt;:r</span> <span class="pre">&lt;file_or_dir&gt;</span></code></p></li>
<li><p>Allow read/write access for a group <code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">-m</span> <span class="pre">g:&lt;group&gt;:rw</span> <span class="pre">&lt;file_or_dir&gt;</span></code></p></li>
<li><p>Revoke granted access <code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">-x</span> <span class="pre">u:&lt;user&gt;</span> <span class="pre">&lt;file_or_dir&gt;</span></code></p></li>
<li><p>See current stage <code class="docutils literal notranslate"><span class="pre">getfacl</span> <span class="pre">&lt;file_or_dir&gt;</span></code></p></li>
</ul>
</li>
</ul>
<p><strong>File managers</strong> on Triton we have installed Midnight Commander – <code class="docutils literal notranslate"><span class="pre">mc</span></code></p>
<p><strong>Advanced file status</strong> to get file meta info <code class="docutils literal notranslate"><span class="pre">stat</span> <span class="pre">&lt;file_or_dir&gt;</span></code></p>
</section>
<section id="exercise-1-2">
<h4>Exercise 1.2<a class="headerlink" href="#exercise-1-2" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>mkdir in the current direcotory, cd there and <code class="docutils literal notranslate"><span class="pre">touch</span></code> a file.
Rename it. Make a copy and then remove the original.  What does <code class="docutils literal notranslate"><span class="pre">touch</span></code> do?</p></li>
<li><p>list all files in /usr/bin and /usr/sbin that start with non-letter characters with
one <code class="docutils literal notranslate"><span class="pre">ls</span></code> command</p></li>
<li><p>list with <code class="docutils literal notranslate"><span class="pre">ls</span></code> dot files/directories only (by default it
lists all files/directories but not those that begin with <code class="docutils literal notranslate"><span class="pre">.</span></code>).
“dotfiles” are a convention where filenames that begin with <code class="docutils literal notranslate"><span class="pre">.</span></code>
such as <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> are considered “hidden”.</p></li>
<li><p>Explore <code class="docutils literal notranslate"><span class="pre">stat</span> <span class="pre">file</span></code> output. What metadata do you find?  Try
to stat files of different types (a regular file, directory, link,
special device in /dev)</p></li>
<li><p>create a directory, use <code class="docutils literal notranslate"><span class="pre">chmod</span></code> to allow user and any group members
full access and no access for others</p></li>
<li><p>(*) change that directory group ownership with <code class="docutils literal notranslate"><span class="pre">chown</span></code> or <code class="docutils literal notranslate"><span class="pre">chgrp</span></code> (any group that you
belong to is fine), set s-bit for the group and
apply t-bit to a directory, check that the upper directory has <em>o+x</em> bit set: now you should
have a private working space for your group. Tip: see groups that you are a member of <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">-Gn</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-ld</span></code> tells you that directory has permissions <code class="docutils literal notranslate"><span class="pre">rwxr-Sr--</span></code>. Do group members have
access there?</p></li>
<li><p>(*) create a directory (in /tmp if you are on a server with ),
use <code class="docutils literal notranslate"><span class="pre">setfacl</span></code> to set its permissions so that only you and some
user/group of your choice would have access to it.</p></li>
<li><p>(*) create a directory and a subdirectory in it and set their permissions to 700 with one command.</p></li>
</ul>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="umask" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.computerhope.com/unix/uumask.htm">https://www.computerhope.com/unix/uumask.htm</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-find"></span><section id="find">
<h3>Find<a class="headerlink" href="#find" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">find</span></code> is a very unixy program: it finds files, but in the most
flexible way possible.</p></li>
<li><p>It is a amazingly complicated program</p></li>
<li><p>It is a number one in searching files in shell</p></li>
</ul>
<p>With no options, just recursively lists all files starting in current directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span>
</pre></div>
</div>
<p>The first option gives a starting directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span>
</pre></div>
</div>
<p>Other search options: by modification/accessing time, by ownership, by access
type, joint conditions, case-insensitive, that do not match, etc <a class="footnote-reference brackets" href="#find1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
<a class="footnote-reference brackets" href="#find2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># -or-  &#39;find ~ $WRKDIR -name file.txt&#39; one can search more than one dir at once
find ~ -name file.txt

# look for jpeg files in the current dir only
find . -maxdepth 1 -name &#39;*.jpg&#39; -type f

# find all files of size more than 10M and less than 100M
find . -type -f -size +10M -size -100M

# find everything that does not belong to you
find ~ ! -user $USER | xargs ls -ld

# open all directories to group members
# tip: chmod applies x-bit to directories automatically
find . -type d -exec chmod g+rw {} \;

# find all s-bitted executable binaries
find /usr/{bin,sbin} -type f -perm -u+x,u+s

# find and remove all files older than 7 days
find path/dir -type f -mtime +7 -exec rm -f {} \;
</pre></div>
</div>
<p>Find syntax is actually an entire boolean logic language given on the
command line: it is a single expression evaluated left to right with
certain precedence.  There are match expressions and action
expressions.  Thus, you can get amazingly complex if you want to.
Take a look at the ‘EXAMPLES’ section in <em>man find</em> for the comprehensive list
of examples and explanations.</p>
<p><strong>find on Triton</strong>  On Triton’s WRKDIR you should use <code class="docutils literal notranslate"><span class="pre">lfs</span> <span class="pre">find</span></code>.  This uses a raw lustre connection
to make it more efficient than accessing every file. It has somewhat limited abilities as comparing
to GNU find. For details <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">lfs</span></code> on Triton.</p>
<p><strong>Fast find – locate</strong>  Another utility that you may find useful <code class="docutils literal notranslate"><span class="pre">locate</span> <span class="pre">&lt;pattern&gt;</span></code>, but on
workstations only.  This uses a cached database of all files, and
just searches that database so it is much faster.</p>
<p><strong>Too many arguments</strong>  error solved with the <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">...</span> <span class="pre">|</span> <span class="pre">xargs</span></code></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="find1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://alvinalexander.com/unix/edu/examples/find.shtml">https://alvinalexander.com/unix/edu/examples/find.shtml</a></p>
</aside>
<aside class="footnote brackets" id="find2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.softpanorama.org/Tools/Find/index.shtml">http://www.softpanorama.org/Tools/Find/index.shtml</a></p>
</aside>
</aside>
</section>
<span id="document-file-archive-transfer"></span><section id="file-archiving-and-transferring">
<h3>File archiving and transferring<a class="headerlink" href="#file-archiving-and-transferring" title="Link to this heading"></a></h3>
<section id="file-archiving">
<h4>File archiving<a class="headerlink" href="#file-archiving" title="Link to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">tar</span></code> is the de-facto standard tool for saving many files or
directories into a single archive file.  Archive files may have
extenssions <em>.tar</em>, <em>.tar.gz</em> etc depending on compression.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create tar archive gzipped on the way</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">caf</span> <span class="n">arhive_name</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="n">directory_to_be_archived</span><span class="o">/</span>

<span class="c1"># extract files</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xaf</span> <span class="n">archive_name</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">C</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">directory</span>
</pre></div>
</div>
<p>Other command line options: <em>r</em> - append files to the end of an
archive, <em>t</em> - list archive content. <em>f</em> is for the filename, and <em>a</em>
selects the compression method based on the archive file suffix (in
this example gzip, due to the .gz suffix. Without compression
files/directories are simply packed as is.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># xz has better compression ratio than gzip, but is very slow</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">caf</span> <span class="n">archive_file</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span> <span class="n">dir1</span><span class="o">/</span> <span class="n">dir2</span><span class="o">/</span>
</pre></div>
</div>
<p>Individual files can be compressed directly, e.g. with <code class="docutils literal notranslate"><span class="pre">gzip</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># file.gz is created, file is removed in the process.</span>
<span class="n">gzip</span> <span class="n">file</span>
<span class="c1"># Uncompress</span>
<span class="n">gunzip</span> <span class="n">file</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</section>
<section id="transferring-files-archiving-on-the-fly">
<h4>Transferring files (+archiving on the fly)<a class="headerlink" href="#transferring-files-archiving-on-the-fly" title="Link to this heading"></a></h4>
<p>As an Aalto user you may use remote directories <a class="footnote-reference brackets" href="#aaltoremotemount" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
Here we cover general use case, transferring from the command line.</p>
<p>For transferring single files or directories there is <em>scp</em>, though
for FTP like functionality there is SFTP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># transferring a file from the remote server to the current directory</span>
<span class="n">sftp</span> <span class="n">LOGIN</span><span class="nd">@remote</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fi</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file_to_copy</span> <span class="o">.</span>

<span class="c1"># transferring files from your workstation to  remote server</span>
<span class="n">sftp</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file_to_copy</span> <span class="n">LOGIN</span><span class="nd">@remote</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fi</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span><span class="o">/</span><span class="n">directory</span>
</pre></div>
</div>
<p>Another use case, making a directory backup with <code class="docutils literal notranslate"><span class="pre">rsync</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sync two directories</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">vauW</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">dir1</span><span class="o">/</span> <span class="n">LOGIN</span><span class="nd">@remote</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fi</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span><span class="o">/</span><span class="n">dir1</span>
</pre></div>
</div>
<p>(*) Transferring and archiving your data on the fly to some other place. The example
will be in covered in details later.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="n">czf</span> <span class="o">-</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">dir</span> <span class="o">|</span> <span class="n">ssh</span> <span class="n">LOGIN</span><span class="nd">@remote</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fi</span> <span class="s1">&#39;cat &gt; path/to/archive/dir/archive_file.tar.gz&#39;</span>
</pre></div>
</div>
</section>
<section id="exercise-1-3">
<h4>Exercise 1.3<a class="headerlink" href="#exercise-1-3" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Find with <code class="docutils literal notranslate"><span class="pre">find</span></code> all the files in your $HOME that are readable or writable by everyone</p>
<ul>
<li><p>(*) apply <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">o-rwx</span></code> to all recently found files with <code class="docutils literal notranslate"><span class="pre">find</span></code></p></li>
</ul>
</li>
<li><p>Make a tar.gz archive of any of your directory, when done list the archive content</p></li>
<li><p>Extract only one particular file to a subdirectory from the archive</p></li>
<li><p>Transfer just created archive using <code class="docutils literal notranslate"><span class="pre">sftp</span></code> (if still time, do the same with scp and rsync).</p>
<ul>
<li><p>(*) Try ssh+tar combo to make transfer and archive on the fly.</p></li>
</ul>
</li>
</ul>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="aaltoremotemount" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://scicomp.aalto.fi/aalto/remoteaccess/#remote-mounting-of-network-filesystems">https://scicomp.aalto.fi/aalto/remoteaccess/#remote-mounting-of-network-filesystems</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-cli_utiltities"></span><section id="command-line-utilities">
<h3>Command line utilities<a class="headerlink" href="#command-line-utilities" title="Link to this heading"></a></h3>
<section id="utilities-the-building-blocks-of-shell">
<h4>Utilities: the building blocks of shell<a class="headerlink" href="#utilities-the-building-blocks-of-shell" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>wide range of all kind of utilities available in Linux</p></li>
<li><p>shell is a glue to bind them all together</p></li>
<li><p>commandline is often a long list of those utilities joint into pipe
that pass output of each other further</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">uname</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">pstree</span><span class="p">,</span> <span class="n">bg</span><span class="o">/</span><span class="n">fg</span><span class="p">,</span> <span class="n">jobs</span><span class="p">,</span> <span class="n">kill</span><span class="p">,</span> <span class="n">touch</span>
<span class="n">ls</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">mkdir</span><span class="p">,</span> <span class="n">ln</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">chmod</span><span class="p">,</span> <span class="n">chgrp</span> <span class="p">(</span><span class="n">chown</span><span class="p">),</span>
<span class="n">find</span><span class="p">,</span> <span class="n">tar</span><span class="p">,</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">sftp</span><span class="p">,</span> <span class="n">rsync</span><span class="p">,</span> <span class="n">man</span><span class="p">,</span> <span class="n">nano</span> <span class="p">(</span><span class="n">vim</span><span class="o">/</span><span class="n">emacs</span><span class="p">),</span> <span class="n">less</span><span class="p">,</span> <span class="n">ssh</span><span class="p">,</span> <span class="o">...</span>
<span class="n">grep</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">uniq</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">xargs</span><span class="p">,</span>
<span class="n">date</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">cal</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">tee</span><span class="p">,</span>
<span class="n">sed</span><span class="p">,</span> <span class="n">awk</span><span class="p">,</span> <span class="n">paste</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>Additional utilities for the software development, system administration etc</p>
<p><strong>Coreutils by GNU</strong> You may find many other useful commands at
<a class="reference external" href="https://www.gnu.org/software/coreutils/manual/coreutils.html">https://www.gnu.org/software/coreutils/manual/coreutils.html</a></p>
</section>
<section id="input-and-output-redirect-and-pipes">
<h4>Input and output: redirect and pipes<a class="headerlink" href="#input-and-output-redirect-and-pipes" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>stdout and stdin from the processes section, you remember right? each process has it</p></li>
<li><p>by default <em>stdout</em> goes to the screen and <em>stdin</em> expects input from the keyboard</p></li>
<li><p>we can change that on demand: pipes and redirections</p></li>
</ul>
<p>Pipe: output of the first command as an input for the second one <code class="docutils literal notranslate"><span class="pre">command_a</span> <span class="pre">|</span> <span class="pre">command_b</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># see what files/directories use the most space, including hidden ones
du -hs * .[!.]* | sort -h | tail -n 10

# count a number of logged in users
w -h | wc -l

# send man page to a default printer
man -t ls | lpr

# print all non-printable characters as well
ls -lA | cat -A
</pre></div>
</div>
<dl class="simple">
<dt>Redirects:</dt><dd><ul class="simple">
<li><p>Like pipes, but send data to/from files instead of other processes.</p></li>
<li><p>Replace a file: <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">&gt;</span> <span class="pre">file.txt</span></code></p></li>
<li><p>Append to a file: <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">&gt;&gt;</span> <span class="pre">file.txt</span></code> (be careful you do not mix them up!)</p></li>
<li><p>Redirect file as STDIN: <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">&lt;</span> <span class="pre">file</span></code>  (in case program accepts STDIN only)</p></li>
</ul>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">Hello</span> <span class="n">World</span> <span class="o">&gt;</span> <span class="n">hello</span><span class="o">.</span><span class="n">txt</span>

<span class="n">ls</span> <span class="o">-</span><span class="n">lH</span> <span class="o">&gt;&gt;</span> <span class="n">current_dir_ls</span><span class="o">.</span><span class="n">txt</span>

<span class="c1"># create a few dummy files</span>
<span class="n">echo</span> <span class="s1">&#39;a b c&#39;</span> <span class="o">&gt;</span> <span class="n">file1</span>
<span class="n">echo</span> <span class="s1">&#39;x y z&#39;</span> <span class="o">&gt;</span> <span class="n">file2</span>

<span class="c1"># join two files into one</span>
<span class="n">cat</span> <span class="n">file1</span> <span class="n">file2</span> <span class="o">&gt;</span> <span class="n">file3</span>

<span class="c1"># go through file1 and replace spaces with a new line mark, then output to file2</span>
<span class="n">tr</span> <span class="o">-</span><span class="n">s</span> <span class="s1">&#39; &#39;</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">&lt;</span> <span class="n">file1</span> <span class="o">&gt;</span> <span class="n">file4</span>
<span class="c1"># the same result but another approach: (and more readable format)</span>
<span class="n">cat</span> <span class="n">file2</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">s</span> <span class="s1">&#39; &#39;</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">&gt;</span> <span class="n">file5</span>

<span class="c1"># join file1 and 2 lines one by one using : as a delimiter</span>
<span class="n">paste</span> <span class="o">-</span><span class="n">d</span> <span class="p">:</span> <span class="n">file4</span> <span class="n">file5</span> <span class="o">&gt;</span> <span class="n">file6</span>

<span class="c1"># get rid of output, &#39;null&#39; is a special device</span>
<span class="n">command</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
<p><strong>This is the unix philosophy</strong> and the true power of the shell.  The
unix philosophy is a lot of small, specialized, good programs
which can be easily connected together. The beauty of the cli are elegant one-liners
i.e. list of commands executed in one line.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># tar and copy directory to a remote host</span>
<span class="n">tar</span> <span class="n">czf</span> <span class="o">-</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">dir</span> <span class="o">|</span> <span class="n">ssh</span> <span class="n">LOGIN</span><span class="nd">@remote</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fi</span> <span class="s1">&#39;cat &gt; path/to/archive/dir/archive_file.tar.gz&#39;</span>

<span class="c1"># to remove all carriage returns and Ctrl-z characters from a Windows file</span>
<span class="n">cat</span> <span class="n">win</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span><span class="se">\15\32</span><span class="s1">&#39;</span> <span class="o">&gt;</span> <span class="n">unix</span><span class="o">.</span><span class="n">txt</span>

<span class="c1"># extract user names and store them to a file</span>
<span class="n">getent</span> <span class="n">passwd</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span><span class="p">:</span> <span class="o">-</span><span class="n">f1</span><span class="p">,</span><span class="mi">5</span> <span class="o">&gt;</span> <span class="n">users</span>

<span class="c1"># print the name of the newest file in the directory (non-dot)</span>
<span class="n">ls</span> <span class="o">-</span><span class="mi">1</span><span class="n">tF</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;*/|@&#39;</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.bashoneliners.com/">http://www.bashoneliners.com/</a></p>
</section>
<section id="groupping-commands">
<h4>Groupping commands<a class="headerlink" href="#groupping-commands" title="Link to this heading"></a></h4>
<p>To dump output of all commands at once: group them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">command1</span><span class="p">;</span> <span class="n">command2</span><span class="p">;</span> <span class="p">}</span> <span class="o">&gt;</span> <span class="n">filename</span>  <span class="c1"># commands run in the current shell  as a group</span>
<span class="p">(</span> <span class="n">command1</span><span class="p">;</span> <span class="n">command2</span><span class="p">;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">filename</span>  <span class="c1"># commands run in external shell as a group</span>
</pre></div>
</div>
</section>
<section id="stderr">
<h4>stderr<a class="headerlink" href="#stderr" title="Link to this heading"></a></h4>
<p>A separate stream (=file descriptor), though we can direct it as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># redirect both stderr and stdout to /dev/null</span>
<span class="n">ping</span> <span class="o">-</span><span class="n">c</span> <span class="mi">1</span> <span class="mf">8.8.8.8</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>

<span class="c1"># piping both</span>
<span class="n">command_a</span> <span class="o">&amp;|</span> <span class="n">command_b</span>
</pre></div>
</div>
<p>Advanced usage cases, like subshells, process substitution, other file descriptors
than stdin/stderr/stdout etc will be covered in the Part 2 of this course.</p>
</section>
</section>
<span id="document-pipelines-grep"></span><section id="evaluations-separators-and-grep">
<h3>Evaluations, separators and grep<a class="headerlink" href="#evaluations-separators-and-grep" title="Link to this heading"></a></h3>
<section id="evaluations-and-separators">
<h4>Evaluations and separators:  ;  &amp;&amp;  ||<a class="headerlink" href="#evaluations-and-separators" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>With ; you can put several commands on the same line.</p></li>
</ul>
<p>Chaining: <code class="docutils literal notranslate"><span class="pre">command_a</span> <span class="pre">;</span> <span class="pre">command_b</span></code>: always runs both commands.</p>
<p>Remember exit codes?  In shell, 0=success and anything 1-255=failure.
Note that this is opposite of normal Boolean logic!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">||</span></code> are <a class="reference external" href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuit</a> (lazy)
boolean operators.  They can be used for quick conditionals.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">command_a</span> <span class="pre">&amp;&amp;</span> <span class="pre">command_b</span></code></p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">command_a</span></code> is successful, also run <code class="docutils literal notranslate"><span class="pre">command_b</span></code></p></li>
<li><p>final exit code is last evaluated one, which has the role of Boolean <em>and</em>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">command_a</span> <span class="pre">||</span> <span class="pre">command_b</span></code></p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">command_a</span></code> is <em>not</em> successful, also run <code class="docutils literal notranslate"><span class="pre">command_b</span></code></p></li>
<li><p>final exit code is that of the last evaluated command, which has
the role of Boolean <em>or</em>.</p></li>
</ul>
</li>
</ul>
<p><strong>Hint</strong> <code class="docutils literal notranslate"><span class="pre">command_a</span> <span class="pre">&amp;&amp;</span> <span class="pre">command_b</span> <span class="pre">||</span> <span class="pre">command_c</span></code></p>
<p>Try: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/nonexistent_dir</span> <span class="pre">&amp;&amp;</span> <span class="pre">ls</span> <span class="pre">/nonexistent_dir</span></code> compare with <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/nonexistent_dir;</span> <span class="pre">ls</span> <span class="pre">/nonexistent_dir</span></code></p>
<p>Try: <code class="docutils literal notranslate"><span class="pre">ping</span> <span class="pre">-c</span> <span class="pre">1</span> <span class="pre">8.8.8.8</span> <span class="pre">&gt;</span> <span class="pre">/dev/null</span> <span class="pre">&amp;&amp;</span> <span class="pre">echo</span> <span class="pre">online</span> <span class="pre">||</span> <span class="pre">echo</span> <span class="pre">offline</span></code></p>
</section>
<section id="grep">
<h4>grep<a class="headerlink" href="#grep" title="Link to this heading"></a></h4>
<p>Later on you’ll find out that <code class="docutils literal notranslate"><span class="pre">grep</span></code> is one of the most useful
commands you ever discover on Linux (except for all the <em>other</em> most
useful commands ever)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="o">&lt;</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>  <span class="c1"># grep lines that match &lt;pattern&gt;</span>
 <span class="o">-</span><span class="ow">or</span><span class="o">-</span>
<span class="n">command</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">pattern</span><span class="o">&gt;</span>  <span class="c1"># grep lines from stdin</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># search all the files in the dir/ and its subdirs, to match the word &#39;is&#39;, case insensitive</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">iw</span> <span class="s1">&#39;is&#39;</span> <span class="nb">dir</span><span class="o">/</span>

<span class="c1"># grep all lines from *command* output, except those that have &#39;comment&#39; in it</span>
<span class="o">*</span><span class="n">command</span><span class="o">*</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="n">comment</span>

<span class="c1"># displaying 2 extra lines before and after the match (-A just after, -B just before)</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">C</span> <span class="mi">2</span> <span class="s1">&#39;search word&#39;</span> <span class="n">file</span>

<span class="c1"># counts the number of matches</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># shows only the matched part of the string (by default grep shows whole line)</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># accepts way more advanced regular expressions as a search pattern</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="o">&lt;</span><span class="n">extended_regexpr</span><span class="o">&gt;</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>For details on what &lt;pattern&gt; could be, look for REGULAR EXPRESSIONS
at <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">grep</span></code>.  Some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># grep emails to a list</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">Eio</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}</span><span class="se">\b</span><span class="s2">&quot;</span> <span class="n">file</span><span class="o">.</span><span class="n">txt</span>

<span class="c1"># grep currently running firefox processes</span>
<span class="n">ps</span> <span class="n">auxw</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">firefox</span>

<span class="c1"># grep H1 and H2 header lines out of HTML file</span>
<span class="n">grep</span> <span class="s2">&quot;&lt;[Hh][12]&gt;&quot;</span> <span class="n">file</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</section>
<section id="exercise-1-4">
<h4>Exercise 1.4<a class="headerlink" href="#exercise-1-4" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>make a pipe that counts number of files/directories (including dot files) in your directory</p></li>
<li><p>grep directories out of <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code></p></li>
<li><p>grep all but blank lines of the ‘man cut | grep …’</p></li>
<li><p>Using pipes and commands echo/tr/uniq, find doubled words out of <code class="docutils literal notranslate"><span class="pre">My</span>
<span class="pre">Do</span> <span class="pre">Do</span> <span class="pre">list:</span> <span class="pre">Find</span> <span class="pre">a</span> <span class="pre">a</span> <span class="pre">Doubled</span> <span class="pre">Word</span></code>.</p></li>
<li><p>If you are on a multiuser system, count unique logged in users.
Tip: <code class="docutils literal notranslate"><span class="pre">w</span></code> or <code class="docutils literal notranslate"><span class="pre">users</span></code> gives you a list of all currently login users,
many of them have several sessions open. Commands to discover: cut / sort / wc</p></li>
<li><p>(*) Play with the commands grep, cut: find at least two ways to
extract IP addresses out of /etc/hosts. Tip: <em>grep</em> has <em>-o</em> option, thus one can build
a regular expression that will grab exactly what you need.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-init_files"></span><section id="initialization-files-and-file-editing">
<h3>Initialization files and file editing<a class="headerlink" href="#initialization-files-and-file-editing" title="Link to this heading"></a></h3>
<section id="initialization-files-and-configuration">
<h4>Initialization files and configuration<a class="headerlink" href="#initialization-files-and-configuration" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>When the shell first starts (when you login), it reads some files.
These are normal shell files, and it evaluates normal shell commands
to set configuration.</p></li>
<li><p>You can always test things in your own shell and see if it works
before putting it in the config files.  Highly recommended!</p></li>
<li><p>You customize your environment means setting or expanding aliases,
variables, functions.</p></li>
<li><p>The config files are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> (when SSH) and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> (interactive login to a workstation)</p></li>
<li><p>they are often a symlink from one to another</p></li>
</ul>
</li>
<li><p>To get an idea how complicated .bashrc can be take a look at &lt;<a class="reference external" href="https://www.tldp.org/LDP/abs/html/sample-bashrc.html">https://www.tldp.org/LDP/abs/html/sample-bashrc.html</a>&gt;</p></li>
</ul>
<p>One of the things to play with: command line prompt defined in PS1 <a class="footnote-reference brackets" href="#ps1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS1</span><span class="o">=</span><span class="s2">&quot;[\d </span><span class="se">\t</span><span class="s2"> \u@\h:\w ] $ &quot;</span>
</pre></div>
</div>
<p>For special characters see PROMPTING at <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">bash</span></code>. To make it
permanent, should be added to <em>.bashrc</em> like <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PS1</span></code>.</p>
</section>
<section id="creating-editing-viewing-file">
<h4>Creating/editing/viewing file<a class="headerlink" href="#creating-editing-viewing-file" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>A <em>text editor</em> edits files as ASCII.  These are your best friend.
In fact, text files are your best friend: rawest, most efficient,
longest-lasting way of storing data.</p></li>
<li><p>“pager” is a generic term for things that view files or data.</p></li>
</ul>
<p>Linux command line <em>text editors</em> like:</p>
<ul class="simple">
<li><p><em>nano</em> - simplest</p></li>
<li><p><em>vim</em> - minimal.  To save&amp;quit, <code class="docutils literal notranslate"><span class="pre">ESC</span> <span class="pre">:wq</span></code></p></li>
<li><p><em>emacs</em> - or the simplest one <em>nano</em>.  To save&amp;quit: <code class="docutils literal notranslate"><span class="pre">Ctrl-x</span>
<span class="pre">Ctrl-c</span></code></p></li>
</ul>
<p>To view contents of a file in a scrollable fashion: <code class="docutils literal notranslate"><span class="pre">less</span></code></p>
<p>Quick look at the text file <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">filename.txt</span></code> (dumps everything to
screen- beware of non-text binary files or large files!)</p>
<p>Other quick ways to add something to a file (no need for an editor)</p>
<p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">'Some</span> <span class="pre">sentence,</span> <span class="pre">or</span> <span class="pre">whatever</span> <span class="pre">else</span> <span class="pre">1234567!-+&gt;$#'</span> <span class="pre">&gt;</span> <span class="pre">filename.txt</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">&gt;</span> <span class="pre">filename2.txt</span></code> to finish typing and write written to the file, press enter, then Ctrl-d.</p>
<p><strong>The best text viewer ever</strong> <code class="docutils literal notranslate"><span class="pre">less</span> <span class="pre">-S</span></code>  (to open a file in your EDITOR, hit <em>v</em>, to search through type <em>/search_word</em>)</p>
<p><strong>Watching files while they grow</strong> <code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-n</span> <span class="pre">0</span> <span class="pre">-f</span> <span class="pre">&lt;file&gt;</span></code></p>
<p>Try: add above mentioned <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PS1</span></code> to <em>.bashrc</em>. Remember <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">.bashrc</span></code> to enable changes</p>
</section>
<section id="exercise-1-5">
<h4>Exercise 1.5<a class="headerlink" href="#exercise-1-5" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>link <em>.bash_profile</em> to <em>.bashrc</em>. Tip: see <code class="docutils literal notranslate"><span class="pre">ln</span></code> command from the previous session.</p></li>
<li><p>add <code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">027</span></code> to <em>.bashrc</em>, try creating files. Tip: <code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">-S</span></code> prints your current setting.</p></li>
<li><p>customize a prompt <code class="docutils literal notranslate"><span class="pre">$PS1</span></code> and add it to your <em>.bashrc</em>, make sure is has
a current directory name and the hostname in it in the format <em>hostname:/path/to/current/dir</em>.
Hint: save the original PS1 like <code class="docutils literal notranslate"><span class="pre">oldPS1=$PS1</span></code> to be able to recover it any time.</p></li>
</ul>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="ps1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.ibm.com/developerworks/linux/library/l-tip-prompt/">https://www.ibm.com/developerworks/linux/library/l-tip-prompt/</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-hotkeys"></span><section id="how-to-make-things-faster-hotkeys">
<h3>How to make things faster: hotkeys<a class="headerlink" href="#how-to-make-things-faster-hotkeys" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Is it annoying to have to type everything in the shell?  No, because
we have hotkeys.  In fact, it can become much more efficient and
powerful to use the shell.</p></li>
<li><p>Most important key: <strong>TAB</strong>: autocomplete.  You should never be
typing full filenames or command names.  TAB can complete almost anything</p></li>
</ul>
<p>Common hotkeys:</p>
<ul class="simple">
<li><p>TAB – autocomlpetion</p></li>
<li><p>Home <code class="docutils literal notranslate"><span class="pre">or</span></code> Ctrl-a – start of the command line</p></li>
<li><p>End <code class="docutils literal notranslate"><span class="pre">or</span></code> Ctrl-e – end</p></li>
<li><p>Ctrl-left/right arrows <code class="docutils literal notranslate"><span class="pre">or</span></code> Alt-b/Alt-f  - moving by one word there and back</p></li>
<li><p>up/down arrows – command history</p></li>
<li><p>Ctrl-l – clear the screen</p></li>
<li><p>Ctrl-Shift-c – copy</p></li>
<li><p>Ctrl-Shift-v – paste</p></li>
<li><p>Ctrl-Shift–  – undo the last changes on cli</p></li>
<li><p>Alt-r – undo all changes made to this line</p></li>
<li><p>Ctrl-r – command history search: backward (hit Ctrl-r, then start typing the search word, hit Ctrl-r again to go through commands that have the search word in it)</p></li>
<li><p>Ctrl-s  – search command history furtherword (for this to work one needs to disable default suspend keys <code class="docutils literal notranslate"><span class="pre">stty</span> <span class="pre">-ixon</span></code>)</p></li>
<li><p>Ctrl-u  – remove beginning of the line, from cursor</p></li>
<li><p>Ctrl-k – remove end of the line, from cursor</p></li>
<li><p>Ctrl-w – remove previous word</p></li>
</ul>
<p><strong>inputrc</strong> Check <em>/etc/inpurc</em> for some default key bindings, more can be defined <em>~/.inputrc</em> (left as a home exercise)</p>
<p><strong>CDPATH</strong> helps changing directories faster. When you type <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">dirname</span></code>, the shell tries to go
to one of the local subdirectories and if it is not found shell will try the same command from every
directory listed in the <em>$CDPATH</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export CDPATH=$HOME:$WRKDIR:$WRKDIR/project
</pre></div>
</div>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-quoting-substitution-aliases"></span><section id="quoting-substitutions-aliases">
<h3>Quoting, substitutions, aliases<a class="headerlink" href="#quoting-substitutions-aliases" title="Link to this heading"></a></h3>
<p>Last time, we focused on interactive things from the command line.
Now, we build on that some and end up with making our own scripts.</p>
<section id="command-line-processing-and-quoting">
<h4>Command line processing and quoting<a class="headerlink" href="#command-line-processing-and-quoting" title="Link to this heading"></a></h4>
<p>So, shell is responsible for interpreting the commands you type. Executing commands
might seem simple enough, but a lot happens between the time you press RETURN and
time your computer actually does something.</p>
<ul class="simple">
<li><p>When you enter a command line, it is one string.</p></li>
<li><p>When a program runs, it always takes an array of strings (the
<code class="docutils literal notranslate"><span class="pre">argv</span></code> in C, <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code> in Python, for example).  How do you get
from one string to an array of strings?  Bash does a lot of
processing.</p></li>
<li><p>The simplest way of looking at it is everything separated by spaces,
but actually there is more: variable substitution, command
substitution, arithmetic evaluation, history evaluation, etc.</p></li>
</ul>
<p>The partial order of operations is (don’t worry about exact order:
just realize that the shell does a lot of different things in same
particular order):</p>
<ul class="simple">
<li><p>history expansion</p></li>
<li><p>brace expansion (<code class="docutils literal notranslate"><span class="pre">{1..9}</span></code>)</p></li>
<li><p>parameter and variable expansion (<code class="docutils literal notranslate"><span class="pre">$VAR</span></code>, <code class="docutils literal notranslate"><span class="pre">${VAR}</span></code>)</p></li>
<li><p>command substitution (<code class="docutils literal notranslate"><span class="pre">$()</span></code>)</p></li>
<li><p>arithmetic expansion (<code class="docutils literal notranslate"><span class="pre">$((1+1))</span></code>)</p></li>
<li><p>word splitting</p></li>
<li><p>pathname expansion (<code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code>, <code class="docutils literal notranslate"><span class="pre">[a,b]</span></code>)</p></li>
<li><p>redirects and pipes</p></li>
</ul>
<p>One thing we will start to see is shell quoting.  There are several types
of quoting (we will learn details of variables later):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Double quotes: disable all other characters except $, &#39;, \</span>
<span class="n">echo</span> <span class="s2">&quot;$SHELL&quot;</span>

<span class="c1"># Single quotes: disable all special characters</span>
<span class="n">echo</span> <span class="s1">&#39;$SHELL&#39;</span>

<span class="c1"># backslash disables the special meaning of the next character</span>
<span class="n">ls</span> <span class="n">name</span>\ <span class="k">with</span>\ <span class="n">space</span>
</pre></div>
</div>
<p>By special characters we mean:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &amp; * ? [ ] ( ) { } = | ^ ; &lt; &gt; ` $ &quot; &#39; \</span>
</pre></div>
</div>
<p>There are different rules for embedding quoting in other quoting.
Sometimes a command passes through multiple layers and you need to
really be careful with multiple layers of quoting!  This is advanced,
but just remember it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo &#39;What&#39;s up? how much did you get $$?&#39;      # wrong, &#39; can not be in between &#39;&#39;
echo &quot;What&#39;s up? how much did you get $$?&quot;      # wrong, $$ is a variable in this case
echo &quot;What&#39;s up? how much did you get \$\$?&quot;    # correct
echo &quot;What&#39;s up? how much did you get &quot;&#39;$$&#39;&quot;?&quot;  # correct
</pre></div>
</div>
<p>At the end of the line <code class="docutils literal notranslate"><span class="pre">\</span></code> removes the new line character, thus the command can continue to a next line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="o">-</span><span class="n">c</span> <span class="mi">1</span> <span class="mf">8.8.8.8</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">&amp;&amp;</span> \
<span class="n">echo</span> <span class="n">online</span> <span class="o">||</span> \
<span class="n">echo</span> <span class="n">offline</span>
</pre></div>
</div>
</section>
<section id="substitute-a-command-output">
<span id="linux-training-substitute-command-output"></span><h4>Substitute a command output<a class="headerlink" href="#substitute-a-command-output" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Command substitutions execute a command, take its stdout, and  place
it on the command line in that place.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$(command)</span></code> or alternatively <code class="docutils literal notranslate"><span class="pre">`command`</span></code>. Could be a command or a
list of commands with pipes, redirections, grouping, variables
inside. The <code class="docutils literal notranslate"><span class="pre">$()</span></code> is a modern way, supports nesting, works inside double
quotes.  To understand what is going on in these, run the inner
command first.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># &#39;whoami&#39; alternative
echo $(id -un):$(id -gn)@$(hostname -s)

# save current date to a variable
today=$(date +%Y-%m-%d)

# create a new file with current timestamp in the name (almost unique filename)
touch file.$(date +%Y-%m-%d-%H-%M-%S)

# archive current directory content, where new archive name is based on current path and date
tar czf $(basename $(pwd)).$(date +%Y-%m-%d).tar.gz .
</pre></div>
</div>
<p>This is what makes BASH powerful!</p>
<p>Note:  <code class="docutils literal notranslate"><span class="pre">$(command</span> <span class="pre">||</span> <span class="pre">exit</span> <span class="pre">1)</span></code> will not have an effect you expect, command is executed in a
subshell, exiting from inside a subshell, closes the subshell only not the parent script.
Subshell can not modify its parent shell environment, though can give back exit code or signal it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># this will not work, echo still will be executed
dir=nonexistent
echo $(ls -l $dir || exit 1)

# this will not work either, since || evaluates echo&#39;s exit code, not ls
echo $(ls -l $dir) || exit 1

# this will work, since assignment a comman substitution to a var returns exit
# code of the executed command
var=$(ls -l $dir) || exit 1
echo $var
</pre></div>
</div>
</section>
<section id="more-about-redirection-piping-and-process-substitution">
<h4>More about redirection, piping and process substitution<a class="headerlink" href="#more-about-redirection-piping-and-process-substitution" title="Link to this heading"></a></h4>
<p><em>STDIN</em>, <em>STDOUT</em> and <em>STDERR</em>: reserved file descriptors <em>0</em>, <em>1</em> and <em>2</em>. They always there
whatever process you run. But one can use other file descriptors as well.</p>
<p><em>File descriptor</em> is a number that uniquely identifies an open file.</p>
<p><em>/dev/null</em>  file (actually special operating system device) that
discards all data written to it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># discards STDOUT only</span>
<span class="n">command</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>

<span class="c1"># discards both STDOUT and STDERR</span>
<span class="n">command</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">command</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span>    <span class="c1"># same as above, old style notation</span>

<span class="c1"># redirects outputs to different files</span>
<span class="n">command</span> <span class="mi">1</span><span class="o">&gt;</span><span class="n">file</span><span class="o">.</span><span class="n">out</span> <span class="mi">2</span><span class="o">&gt;</span><span class="n">file</span><span class="o">.</span><span class="n">err</span>

<span class="c1"># takes STDIN as an input and outputs STDOUT/STDERR to a file</span>
<span class="n">command</span> <span class="o">&lt;</span> <span class="n">input_file</span> <span class="o">&amp;&gt;</span> <span class="n">output_file</span>
</pre></div>
</div>
<p>Note, that <code class="docutils literal notranslate"><span class="pre">&amp;&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;&amp;</span></code> will do the same, redirect both STDOUT and STDERR
to the same place, but the former syntax is preferable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># what happens if 8.8.8.8 is down? How to make the command more robust?
ping -c 1 8.8.8.8 &gt; /dev/null &amp;&amp; echo online || echo down

# takes a snapshot of the directory list and send it to email, then renames the file
ls -l &gt; listing &amp;&amp; { mail -s &quot;ls -l $(pwd)&quot; jussi.meikalainen@aalto.fi &lt; listing; mv listing listing.$(date +&quot;%Y-%m-%d-%H-%M&quot;); }

# a few ways to empty a file
&gt; filename
cat /dev/null &gt; filename

# read file to a variable
var=$(&lt; path/to/file)

# extreme case, if you can&#39;t get the program to stop writing to the file...
ln -s /dev/null filename
</pre></div>
</div>
<p>Pipes are following the same rules with respect to standard output/error. In order to pipe both STDERR and STDOUT <code class="docutils literal notranslate"><span class="pre">|&amp;</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">!</span></code>  preceeds the command, the exit status is the logical negation.</p>
<p><strong>tee</strong> in case you still want output to a terminal and to a file <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">|</span> <span class="pre">tee</span> <span class="pre">filename</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">&gt;</span> <span class="pre">output.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">2&gt;</span> <span class="pre">errors.txt</span></code> executed in the script will send the output to
the file, standard output or error output correspondingly. Opening other than standard file
descriptors: <strong>exec</strong> causes the shell to hold the file descriptor until the shell dies or
closes it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># open input_file for reading into the file descriptor 3
exec 3&lt; $input_file
# while open, any command can operate on the descriptor
read -n 3 var &lt;&amp;3
command &lt;&amp;3
# mind the file offset, one can read a line, or a few chars, if you have read the file
# to the end, to reset the offset, run another &#39;exec 3&lt; ...&#39;
# close the descriptor after you are done
exec 3&gt;&amp;-

# similar for writing
exec 5&gt; $output_file; command &gt; &amp;5; ...; exec 5&gt;&amp;-
# or appending (keep in mind that you use &gt;&gt; only to open the file)
exec 5&gt;&gt; $output_file; command &gt; &amp;5; ...; exec 5&gt;&amp;-
# or writing and reading
exec 6&lt;&gt;$file; ... exec 6&lt;&gt;&amp;-
# or use a name instead of the descriptor numeric value
exec {out}&gt;$output_file; ... echo something &gt;&amp;$out; ...
# redirecting descriptor to another one
exec 3&gt;&amp;1
</pre></div>
</div>
<p>Opening a FD instead of using a file name multiple times may save you some IO. <em>Hint:</em> to monitor the
file operations (system calls) one may employ <strong>strace -f -c -e trace=write,openat your_script</strong>.</p>
<p>But what if you need to pass to another program results of two commands at once? Or if command
accepts file as an argument but not STDIN?</p>
<p>One can always do this in two steps, run commands and save results to file(s) and then use
them with the another command. Though BASH helps to make even this part easier (or harder),
the feature called
<em>Process Substitution</em>, looks like <code class="docutils literal notranslate"><span class="pre">&lt;(command)</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;(command)</span></code>, no spaces in between
parentheses and &lt; signs. It emulates a file creation out of <em>command</em> output
and place it on a command line. The <em>command</em> can be a pipe, pipeline etc.</p>
<p>The actual file paths substituted are <em>/dev/fd/&lt;n&gt;</em>. The file paths can be passed as an
argument to the another command or just redirected as usual.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># BASH creates a file that has an output of *command2* and pass it to *command1*</span>
<span class="c1"># file descriptor is passed as an argument, assuming command1 can handle it</span>
<span class="n">command1</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>

<span class="c1"># same but redirected (like: cat &lt; filename)</span>
<span class="n">command1</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>

<span class="c1"># in the same way one can substitute results of several commands or command groups</span>
<span class="n">command1</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">command3</span> <span class="o">|</span> <span class="n">command4</span><span class="p">;</span> <span class="n">command5</span><span class="p">)</span>

<span class="c1"># example: comparing listings of two directories</span>
<span class="n">diff</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">ls</span> <span class="n">dir1</span><span class="p">)</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">ls</span> <span class="n">dir2</span><span class="p">)</span>

<span class="c1"># and vice versa, *command1* output is redirected as a file to *command2*</span>
<span class="n">command1</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">command2</span><span class="p">)</span>

<span class="c1"># essentially, in some cases pipe and process substituion do the same</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">s</span> <span class="o">|</span> <span class="n">cat</span>
<span class="n">cat</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">ls</span> <span class="o">-</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="aliases">
<h4>Aliases<a class="headerlink" href="#aliases" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Alias is nothing more than a shortcut to a long command sequence</p></li>
<li><p>With alias one can redefine an existing command or name a new one</p></li>
<li><p>Alias will be evaluated only when executed, thus it may have all the expansions and
substitutions one normally has on the cli</p></li>
<li><p>They are less flexible than functions which we will discuss next</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># your own listing command</span>
<span class="n">alias</span> <span class="n">l</span><span class="o">=</span><span class="s1">&#39;ls -lAF&#39;</span>

<span class="c1"># shortcut for checking space usage</span>
<span class="n">alias</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;du -hs .[!.]* * | sort -h&#39;</span>

<span class="c1"># prints in the compact way login:group</span>
<span class="n">alias</span> <span class="n">me</span><span class="o">=</span><span class="s1">&#39;echo &quot;$(id -un):$(id -gn)&quot;&#39;</span>

<span class="c1"># redefine rm</span>
<span class="n">alias</span> <span class="n">rm</span><span class="o">=</span><span class="s1">&#39;rm -i&#39;</span>
<span class="n">alias</span> <span class="n">rm</span><span class="o">=</span><span class="s1">&#39;rm -rf&#39;</span>
</pre></div>
</div>
<p>Aliases go to <em>.bashrc</em> and available later by default (really,
anywhere they can be read by the shell).</p>
</section>
<section id="exercise-2-1">
<h4>Exercise 2.1<a class="headerlink" href="#exercise-2-1" title="Link to this heading"></a></h4>
<p>[Lecturer’s notes: about 40 mins joint hands-on session + break]</p>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Use command substitution to create an empty file with the date in the name, like
<code class="docutils literal notranslate"><span class="pre">file.YYYY-MM-DD.out</span></code>. Tip: investigate <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">+&quot;...&quot;</span></code> examples above and/or <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">date</span></code>.</p></li>
<li><p>Learn Brace expansions <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">{0..9}</span> <span class="pre">{a..z}</span></code>. Using it, create five directories (<code class="docutils literal notranslate"><span class="pre">mkdir</span></code>) in
the current folder with the names like: DIR.NUMBER.CURRENT_YEAR, example mydir.1.2022, mydir.2.2022</p></li>
<li><p>Make a command (so called one-liner) with <code class="docutils literal notranslate"><span class="pre">ls</span></code>, <code class="docutils literal notranslate"><span class="pre">echo</span></code>, redirections etc that takes a file path
and says whether this file/directory exists or not. Redirect STDOUT/STDERR to /dev/null.
Take <code class="docutils literal notranslate"><span class="pre">ping</span> <span class="pre">-c</span> <span class="pre">8.8.8.8</span> <span class="pre">...</span></code> as an example.</p></li>
<li><p>Use the example in the text above to send <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-hs</span> <span class="pre">*</span> <span class="pre">.[!.]*</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-h</span></code> output to yourself via email.</p></li>
<li><p>(*) Use any of the earlier created files to compare there modification times with <code class="docutils literal notranslate"><span class="pre">stat</span> <span class="pre">-c</span> <span class="pre">'%y'</span> <span class="pre">filename</span></code>,
<code class="docutils literal notranslate"><span class="pre">diff</span></code> and the process substitution.</p></li>
<li><p>(*) Using pipes and commands <code class="docutils literal notranslate"><span class="pre">echo</span></code>, <code class="docutils literal notranslate"><span class="pre">tr</span></code>, <code class="docutils literal notranslate"><span class="pre">uniq</span></code>, find doubled words out of
<code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Do</span> <span class="pre">Do</span> <span class="pre">list:</span> <span class="pre">Find</span> <span class="pre">a</span> <span class="pre">a</span> <span class="pre">Doubled</span> <span class="pre">Word.</span></code></p></li>
<li><p>(*) Join <em>find</em> and <em>grep</em> power and find all the files in /{usr/,}{bin,sbin} that have ‘#!/bin/bash’ in it</p></li>
</ul>
</div>
</section>
</section>
<span id="document-variables-functions-environments"></span><section id="variables-functions-environment">
<h3>Variables, functions, environment<a class="headerlink" href="#variables-functions-environment" title="Link to this heading"></a></h3>
<section id="your-bin-and-path">
<h4>Your ~/bin and PATH<a class="headerlink" href="#your-bin-and-path" title="Link to this heading"></a></h4>
<p>The PATH is an environment variable. It is a colon delimited list of directories that your
shell searches through when you enter a command. Binaries are at <em>/bin</em>, <em>/usr/bin</em>,
<em>/usr/local/bin</em> etc. The best place for your own is <em>~/bin</em>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># add to .bashrc</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$PATH:$HOME/bin&quot;</span>
<span class="c1"># after you have your script written, set +x bit and run it</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">script_name</span><span class="o">.</span><span class="n">sh</span>
<span class="n">script_name</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>You can find where a program is using <code class="docutils literal notranslate"><span class="pre">which</span></code> or <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">-a</span></code>, we recommend the later one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="o">-</span><span class="n">a</span> <span class="n">ls</span>      <span class="c1"># a binary</span>
<span class="nb">type</span> <span class="o">-</span><span class="n">a</span> <span class="n">cd</span>      <span class="c1"># builtin</span>
</pre></div>
</div>
<p>Other options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># +x bit and ./</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">script</span><span class="o">.</span><span class="n">sh</span>
<span class="o">./</span><span class="n">script</span><span class="o">.</span><span class="n">sh</span>   <span class="c1"># that works if script.sh has #!/bin/bash as a first line</span>
<span class="c1"># with no x bit</span>
<span class="n">bash</span> <span class="n">script</span><span class="o">.</span><span class="n">sh</span>  <span class="c1"># this will work even without #!/bin/bash</span>
</pre></div>
</div>
<p><strong>Extension is optional</strong> note that <em>.sh</em> extension is optional, script may have any name</p>
</section>
<section id="variables">
<h4>Variables<a class="headerlink" href="#variables" title="Link to this heading"></a></h4>
<p>In shell, variables define your environment. Common practice is that environmental vars are written IN CAPITAL: $HOME, $SHELL, $PATH, $PS1, $RANDOM. To list all defined variables <code class="docutils literal notranslate"><span class="pre">printenv</span></code>. All variables can be used or even redefined. No error if you call an undefined var, it is just considered to be empty:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># assign a variable, note, no need for ; delimiter
var1=100 var2=&#39;some string&#39;

# calling a variable is just putting a $ dollar sign in a front
echo &quot;var1 is $var1&quot;

# re-assign to another var
var3=$var1

# when appending a variable, it is considered to be a string
var+=&lt;string&gt;/&lt;integer&gt;
  var1+=50  # var1 is now 10050
  var2+=&#39; more&#39; # var2 is &#39;some string more&#39;
# we come later to how to deal with the integers (Arithmetic Expanssions $(()) below)
</pre></div>
</div>
<p>There is no need to declare things in advance: there is flexible
typing.  In fact, you can access any variable, defined or not.
However, you can still declare things to be of a certain type if you
need to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">declare</span> <span class="o">-</span><span class="n">r</span> <span class="n">var</span><span class="o">=</span><span class="n">xyz</span>   <span class="c1"># read-only</span>
<span class="n">declare</span> <span class="o">-</span><span class="n">i</span> <span class="n">var</span>  <span class="c1"># must be treated as an integer, &#39;man bash&#39; for other declare options</span>
</pre></div>
</div>
<p>BASH is smart enough to distinguish a variable inline without special quoting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dir=$HOME/dir1 fname=file fext=xyz echo &quot;$dir/$fname.$fext&quot;
</pre></div>
</div>
<p>though if variable followed by a number or a letter, you have to
explicitly separate it with the braces syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo ${dir}2/${file}abc.$fext
</pre></div>
</div>
<p>Built-in vars:</p>
<blockquote>
<div><ul class="simple">
<li><p>$?  exit status of the last command</p></li>
<li><p>$$  current shell pid</p></li>
<li><p>$#  number of input parameters</p></li>
<li><p>$0  running script name, full path</p></li>
<li><p>$FUNCNAME  function name being executed, [ note: actually an array ${FUNCNAME[*]} ]</p></li>
<li><p>$1, $2 … input parameter one by one (function/script)</p></li>
<li><p>“$&#64;” all input parameters as is in one line</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">()</span> <span class="p">{</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot; number of input params: $#</span><span class="se">\n</span><span class="s2"> input params: $@</span><span class="se">\n</span><span class="s2"> shell process id: $$</span><span class="se">\n</span><span class="s2"> script name: $0</span><span class="se">\n</span><span class="s2"> function name: $FUNCNAME&quot;</span><span class="p">;</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span> <span class="n">f</span> <span class="n">arg1</span> <span class="n">arg2</span><span class="p">;</span> <span class="n">echo</span> <span class="s2">&quot;exit code: $?&quot;</span>
</pre></div>
</div>
<p>What if you assing a variable to a variable like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>var2=&#39;something&#39;
var1=\$var2
echo $var1     # will return &#39;$var2&#39; literally

# BASH provides built-in &#39;eval&#39; command that reads the string then re-evaluate it
# if variables etc found, they are given another chance to show themselves

eval echo $var1  # returns &#39;something&#39;
</pre></div>
</div>
<p>In more realistic examples it is often used to compose a command string based on input
parameters or some conditionals and then evaluate it at very end.</p>
</section>
<section id="magic-of-bash-variables">
<h4>Magic of BASH variables<a class="headerlink" href="#magic-of-bash-variables" title="Link to this heading"></a></h4>
<p>BASH provides wide abilities to work with the vars “on-the-fly” with
<code class="docutils literal notranslate"><span class="pre">${var...}</span></code> like constructions.  This lets you do simple text
processing easily.  These are nice, but are easy to forget so you will
need to look them up when you need them.</p>
<blockquote>
<div><ul class="simple">
<li><p>Assign a $var with default <em>value</em> if not defined: <code class="docutils literal notranslate"><span class="pre">${var:=value}</span></code></p></li>
<li><p>Returns $var value or a default <em>value</em> if not defined: <code class="docutils literal notranslate"><span class="pre">${var:-value}</span></code></p></li>
<li><p>Print an <em>error_message</em> if var empty: <code class="docutils literal notranslate"><span class="pre">${var:?error_message}</span></code></p></li>
<li><p>Extract a substring: <code class="docutils literal notranslate"><span class="pre">${var:offset:length}</span></code>, example <code class="docutils literal notranslate"><span class="pre">var=abcde;</span> <span class="pre">echo</span> <span class="pre">${var:1:3}</span></code> returns ‘bcd’</p></li>
<li><p>Variable’s length: <code class="docutils literal notranslate"><span class="pre">${#var}</span></code></p></li>
<li><p>Replace beginning part: <code class="docutils literal notranslate"><span class="pre">${var#prefix}</span></code></p></li>
<li><p>Replace trailing part: <code class="docutils literal notranslate"><span class="pre">${var%suffix}</span></code></p></li>
<li><p>Replace <em>pattern</em> with the <em>string</em>: <code class="docutils literal notranslate"><span class="pre">${var/pattern/string}</span></code></p></li>
<li><p>Modify the case of alphabetic characters: <code class="docutils literal notranslate"><span class="pre">${var,,}</span></code> for lower case or <code class="docutils literal notranslate"><span class="pre">${var^^}</span></code> for upper case</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># will print default_value, which can be a variable
var=&#39;&#39;; echo ${var:-default_value}
var1=another_value; var=&#39;&#39;;  echo ${var:-$var1}

# assign the var if it is not defined
# note that we use &#39;:&#39; no operation command, to avoid BASH&#39;s &#39;command not found&#39; errors
: ${var:=default_value}

# will print &#39;not defined&#39; in both cases
var=&#39;&#39;;  echo ${var:?not defined}
var=&#39;&#39;; err=&#39;not defined&#39;; echo ${var:?$err}

# will return 8, that is a number of characters
var=&#39;abcdefgh&#39;; echo ${#var}

# returns file.ext
var=26_file.ext; echo ${var#[0-9][0-9]_}

# returns archive.tar.gz out of full path
fpath=/home/user/archive.tar.gz; echo ${fpath##*/}
# returns path with no file name
echo ${fpath%/*}

# in both cases returns photo
var=photo.jpeg; echo ${var%.jpeg}
var=26_file.ext; echo ${var%.[a-z][a-z][a-z]}

# returns &#39;I hate you&#39;
var=&#39;I love you&#39;; echo ${var/love/hate}
# other options for substitutions
var=&#39; some text &#39;;
echo ${var/# /}  # returns without the first space
echo ${var/% /}  # without the last space
echo ${var// /}  # without spaces at all
</pre></div>
</div>
<p>Except for the <em>:=</em> the variable remains unchanged. If you want to
redefine a variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>var=&#39;I love you&#39;; var=${var/love/hate}; echo $var  # returns &#39;I hate you&#39;
</pre></div>
</div>
<p>BASH allows indirect referencing, consider:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>var1=&#39;Hello&#39; var2=var1
echo $var2  # returns text &#39;var1&#39;
echo ${!var2}  # returns &#39;Hello&#39; instead of &#39;var1&#39;
</pre></div>
</div>
<p>To address special characters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># replacing all tabs with the spaces in the var
var=${var//$&#39;\t&#39;/ }
</pre></div>
</div>
</section>
<section id="functions">
<h4>Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h4>
<p>Alias is a shortcut to a long command, while function is a piece of programming
that has logic and can accept input parameters. Functions can be defined on-the-fly
from the cli, or can go to a file. Let us set <em>~/bin/functions</em> and collect
everything useful there.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># whoami alternative turned into function
me() {
  $(id -un):$(id -gn)@$(hostname -s)
}

# turn check space usage into a function
spaceusage() {
  du -hs * .[!.]* | sort -h
}

# in one line, note spaces and ; delimiters
myfunction() { command; command; }
# -or- in a full format
function myfunction { command; command; }
</pre></div>
</div>
<p>Read functions into the current shell environment and run them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">functions</span>
<span class="n">me</span>
<span class="n">spaceusage</span>
</pre></div>
</div>
<p>The function refers to passed arguments by their position (not by name),
that is $1, $2, and so forth:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>func_name arg1 arg2 arg3  # will become $1 $2 $3

# advanced version of spaceusage using BASH variables magic
spaceusage() {
  du -hs ${1:-.}/* ${1:-.}/.[!.]* | sort -h;
}
</pre></div>
</div>
<p>Functions in BASH have <code class="docutils literal notranslate"><span class="pre">return</span></code> but it only returns the exit code. Useful
in cases where you want to ‘exit’ the function and continue to the rest of the script.
By default functions’ variables are in the global space, once chaged in the function is
seen everywhere else. <code class="docutils literal notranslate"><span class="pre">local</span></code> can be used to localize the vars. Compare:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>var=2; f() { var=3; }; f; echo $var
var=2; f() { local var=3; }; f; echo $var

# get filename out of path
filename() {
  local fpath=${1:?path is missing} &amp;&amp; \
  echo ${fpath##*/}
}

# filepath with no name
filepath() {
  local fpath=${1:?path is missing} &amp;&amp; \
  echo ${fpath%/*}
}
</pre></div>
</div>
<p>If you happened to build a function in an alias way, redefining a command name while
using that original command inside the function, you need to type <em>command</em> before
the name of the command, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span><span class="p">()</span> <span class="p">{</span> <span class="n">command</span> <span class="n">rm</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;$@&quot;</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>here you avoid internal loops (forkbombs).</p>
<p>Exporting a function with <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">-f</span> <span class="pre">function_name</span></code> lets you pass a function to a sub-shell,
by storing that function in a environment variable. Helpful when you want to use it within a
command substitution, or any other case that launches a subshell, like
<code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">...</span> <span class="pre">-exec</span> <span class="pre">bash</span> <span class="pre">-c</span> <span class="pre">'function_name</span> <span class="pre">{}'</span> <span class="pre">\;</span></code>.</p>
</section>
<section id="exercise-2-2">
<h4>Exercise 2.2<a class="headerlink" href="#exercise-2-2" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">spaceusage()</span></code>, <code class="docutils literal notranslate"><span class="pre">filename()</span></code>, <code class="docutils literal notranslate"><span class="pre">filepath()</span></code>, <code class="docutils literal notranslate"><span class="pre">me()</span></code> to your <em>~/bin/functions</em> and play with them.
Note: here and later, we suggest that all newly created functions would go to <em>~/bin/functions</em> file.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">filename()</span></code> function make a <code class="docutils literal notranslate"><span class="pre">filebasename()</span></code> so that function would output a <em>filename</em> with no
extension. Like <code class="docutils literal notranslate"><span class="pre">filebasename</span> <span class="pre">path/to/archive.tar.gz</span></code> would return <em>archive</em>.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">find</span></code> utility, implement a <em>fast find</em> (=*ff*) function <code class="docutils literal notranslate"><span class="pre">ff</span> <span class="pre">word</span></code>. This function must return all
the files and directories in the current folder which name contains <em>&lt;word&gt;</em>. Let it be case insensitive.
Hint: <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-iname</span> <span class="pre">...</span></code></p></li>
<li><p>(*) Make an advanced version of <code class="docutils literal notranslate"><span class="pre">ff()</span></code> that would accept a directory name to search at as a second
argument <em>($2)</em> and if it is missing then would use current. For a example <code class="docutils literal notranslate"><span class="pre">ff</span> <span class="pre">word</span> <span class="pre">path/to/</span></code>.</p></li>
<li><p>(*) <code class="docutils literal notranslate"><span class="pre">:()</span> <span class="pre">{</span> <span class="pre">:|:&amp;;</span> <span class="pre">};:</span></code> is a BASH fork-bomb [WARNING: Do not run it!]. Can you explain how it works it?
<em>&amp;</em> in this case sends process to the background.</p></li>
<li><p>(*) On Triton write a function that <code class="docutils literal notranslate"><span class="pre">lfs</span> <span class="pre">find</span></code> all the dirs/files at $WRKDIR that do not
belong to your group and fix the group ownership. Use <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">...</span> <span class="pre">|</span> <span class="pre">xargs</span></code>. Tip: on Triton at
WRKDIR your username $USER and group name are the same. On any other filesystem, <code class="docutils literal notranslate"><span class="pre">$(id</span> <span class="pre">-gn)</span></code>
returns your group name. One can</p></li>
<li><p>(*) Expand the function above to set group’s s-bit on all the $WRKDIR directories.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-conditionals"></span><section id="conditionals">
<h3>Conditionals<a class="headerlink" href="#conditionals" title="Link to this heading"></a></h3>
<section id="tests">
<h4>Tests: <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span></code><a class="headerlink" href="#tests" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">expression</span> <span class="pre">]]</span></code> returns 0=true/success or 1=false/failure depending on the
evaluation of the conditional <em>expression</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">expression</span> <span class="pre">]]</span></code> is a new upgraded variation on <code class="docutils literal notranslate"><span class="pre">test</span></code> (also known as <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">...</span> <span class="pre">]</span></code>),
all the earlier examples with single brackets that one can find online will also work
with double</p></li>
<li><p>Inside the double brackets it performs tilde expansion, parameter and variable expansion,
arithmetic expansion, command substitution, process substitution, and quote removal</p></li>
<li><p>Conditional expressions can be used to test file attributes and perform string and arithmetic
comparisons</p></li>
</ul>
<dl class="simple">
<dt>Selected examples file attributes and variables testing:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">file</span></code> true if is a file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">file</span></code> true if file exists and readable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">dir</span></code> true if is a directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">file</span></code> true if file/dir/etc exists in any form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-z</span> <span class="pre">string</span></code> true if the length of string is zero (always used to check that var is not empty)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">string</span></code> true if the length of string is non-zero</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file1</span> <span class="pre">-nt</span> <span class="pre">file2</span></code> true if <em>file1</em> is newer (modification time)</p></li>
<li><p>many more others</p></li>
</ul>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># check that directory does not exist before creating one
# where $dir is a variable
[[ -d $dir ]] || mkdir $dir

# checks that file exists
[[ -r $file ]] &amp;&amp; mv $file ${file}.$(date +%Y-%m-%d) || echo $file is either non-readable or does not exist
# in the script
[[ -r $file ]] &amp;&amp; mv $file ${file}.$(date +%Y-%m-%d) || { echo $file does not exist; exit 1; }

# Check if script/function is given an argument
[[ -z $1 ]] &amp;&amp; { echo no argument; exit 1; }

# Often used alternative to ${var:-a_value} or ${var:?not defined}
[[ -n $var ]] || echo var is not defined
</pre></div>
</div>
<p>Note that integers have their own construction <code class="docutils literal notranslate"><span class="pre">((</span> <span class="pre">expression</span> <span class="pre">))</span></code> (we come back to this),
though <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span></code> will work for them too.  The following are more tests:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">==</span></code> strings or integers are equal  (<code class="docutils literal notranslate"><span class="pre">=</span></code> also works)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!=</span></code> strings or integers are not equal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string1</span> <span class="pre">&lt;</span> <span class="pre">string2</span></code> true if <em>string1</em> sorts before <em>string2</em> lexicographically</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code> vice versa, for integers greater/less than</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">=~</span> <span class="pre">pattern</span></code> matches the pattern against the string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>  logical AND, conditions can be combined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">||</span></code> logical OR</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!</span></code> negate the result of the evaluation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">()</span></code> group conditional expressions</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># If &#39;var&#39; is ... then
[[ $var == &#39;some_value&#39; ]] &amp;&amp; ...

# If path is ... then
[[ $(pwd) == /some/path ]] &amp;&amp; ...

# grouping () and booleans &amp;&amp; || within the [[ ]]
[[ $(hostname -s) == kosh &amp;&amp; ($(pwd) == $WORK || $(pwd) == $SCRATCH) ]] ...

# note that [[ ]] always require spaces before and after brackets (!)
</pre></div>
</div>
<p>In addition (old school), double brackets inherit several operands to work with integers mainly:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-eq</span></code>, <code class="docutils literal notranslate"><span class="pre">-ne</span></code>, <code class="docutils literal notranslate"><span class="pre">-lt</span></code>, <code class="docutils literal notranslate"><span class="pre">-le</span></code>, <code class="docutils literal notranslate"><span class="pre">-gt</span></code>, <code class="docutils literal notranslate"><span class="pre">-ge</span></code>  equal to, not equal  to,
less  than, less than or equal to, greater than, or greater than or equal</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Some use cases for [[ ]]

# a popular way to check input arguments, if no input, exit (in functions
# &#39;return 1&#39;).  Remember, $# is special variable for number of arguments.
[[ $# -eq 0 ]] &amp;&amp; { echo Usage: $0 arguments; exit 1; }

# if dir exists and is not empty, then archive it
d=path/to/dir; [[ -d $d &amp;&amp; $(ls -A $d) ]] &amp;&amp; tar caf $(basename $d).$(date +%Y-%m-%d).tar.gz $d

# append PATH function
# as an exercise, we will re-implement this with the matching operator =~, see below
appendPATH() {
  local dpath=${1:?directory is missing} &amp;&amp; \
  [[ -d $dpath &amp;&amp; ! $(echo $PATH|grep $dpath) ]] &amp;&amp; export PATH+=:$dpath
}
</pre></div>
</div>
<p>The matching operator <code class="docutils literal notranslate"><span class="pre">=~</span></code> brings more opportunities, because regular expressions come in play.
Matched strings in parentheses assigned to <em>${BASH_REMATCH[]}</em> array elements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># change shell on the Linux server if it is not BASH
[[ ! $SHELL =~ bash ]] &amp;&amp; chsh -s /bin/bash
</pre></div>
</div>
<ul class="simple">
<li><p>Regular expressions (regexs) are basically a mini-language for
searching within, matching, and replacing text in strings.</p></li>
<li><p>They are extremely powerful and basically required knowledge in any
type of text processing.</p></li>
<li><p>Yet there is a famous quote by Jamie Zawinski: “Some people, when
confronted with a problem, think ‘I know, I’ll use regular
expressions.’ Now they have two problems.”  This doesn’t mean
regular expressions shouldn’t be used, but used carefully.  When
writing regexs, start with a small pattern and slowly build it up,
testing the matching at each phase, or else you will end up with a
giant thing that doesn’t work and you don’t know why and can’t debug
it.  There are also online regex testers which help build them.</p></li>
<li><p>While the basics (below) are the same, there are different forms of
regexs!  For example, the <code class="docutils literal notranslate"><span class="pre">grep</span></code> program has regular regexs, but
<code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-E</span></code> has extended.  The difference is mainly in the special
characters and quoting.  Basically, check the docs for each language
(Perl, Python, etc) you want to use regexs in.</p></li>
</ul>
<p>Selected operators:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.</span></code> matches any single character</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?</span></code> the preceding item is optional and will be matched, at most, once</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> the preceding item will be matched zero or more times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code> the preceding item will be matched one or more times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{N}</span></code> the preceding item is matched exactly N times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{N,}</span></code> the preceding item is matched N or more times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{N,M}</span></code> the preceding item is matched at least N times, but not more than M times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[abd]</span></code>, <code class="docutils literal notranslate"><span class="pre">[a-z]</span></code>  a character or a range of characters/integers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">^</span></code>  beginning of a line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span></code>  the end of a line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">()</span></code> grouping items, this what comes to ${BASH_REMATCH[&#64;]}</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># match an email
email=&#39;jussi.meikalainen@aalto.fi&#39;; regex=&#39;(.*)@(.*)&#39;; [[ &quot;$email&quot; =~ $regex ]]; echo ${BASH_REMATCH[*]}

# extract a number out of the text
txt=&#39;A text with #1278 in it&#39;; regex=&#39;#([0-9]+ )&#39;; [[ &quot;$txt&quot; =~ $regex ]] &amp;&amp; echo ${BASH_REMATCH[1]} || echo do not match

# case insensitive matching
var1=ABCD, var2=abcd; [[ ${var1,,} =~ ${var2,,} ]] &amp;&amp; ...
</pre></div>
</div>
<p><strong>For case insesitive matching</strong>, alternatively, in general, set <code class="docutils literal notranslate"><span class="pre">shopt</span> <span class="pre">-s</span> <span class="pre">nocasematch</span></code>
(to disable it back <code class="docutils literal notranslate"><span class="pre">shopt</span> <span class="pre">-u</span> <span class="pre">nocasematch</span></code>)</p>
</section>
<section id="conditionals-if-elif-else">
<h4>Conditionals: if/elif/else<a class="headerlink" href="#conditionals-if-elif-else" title="Link to this heading"></a></h4>
<p>Yes, we have <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span> <span class="pre">&amp;&amp;</span> <span class="pre">...</span> <span class="pre">||</span> <span class="pre">...</span></code> but scripting style is more logical with if/else construction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">condition</span><span class="p">;</span> <span class="n">then</span>
  <span class="n">command1</span>
<span class="k">elif</span> <span class="n">condition</span><span class="p">;</span> <span class="n">then</span>
  <span class="n">command2</span>
<span class="k">else</span>
  <span class="n">command3</span>
<span class="n">fi</span>
</pre></div>
</div>
<p>At the <em>condition</em> place can be anything what returns an exit code, i.e. <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span></code>, command/function,
an arithmetic expression <code class="docutils literal notranslate"><span class="pre">$((</span> <span class="pre">))</span></code>, or a command substitution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># to compare two input strings/integers
if [[ &quot;$1&quot; == &quot;$2&quot; ]]
then
  echo The strings are the same
else
  echo The strings are different
fi

# checking command output
if ping -c 1 google.com &amp;&gt; /dev/null; then
  echo Online
elif ping -c 1 127.0.0.1 &amp;&gt; /dev/null; then
  echo Local interface is down
else
  echo No external connection
fi

# check input parameters
if [[ $# == 0 ]]; then
  echo Usage: $0 input_arg
  exit 1
fi
... the rest of the code
</pre></div>
</div>
<p>Expanding <em>tarit.sh</em> to a script</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# usage: tarit.sh &lt;dirname&gt;

dir=$1

# if directory name is given as an argument
if [[ -d $dir ]]; then
  archive=$(basename $dir).$(date +%Y-%m-%d).tar.gz

# if no argument, then the current directory
elif [[ -z $dir ]]; then
  dir=&#39;.&#39;
  archive=$(basename $(pwd)).$(date +%Y-%m-%d).tar.gz

# otherwise error and exit
else
  echo $dir does not exist or empty
  exit 1
fi

# run tar
tar caf $archive $dir
</pre></div>
</div>
</section>
<section id="case">
<h4>case<a class="headerlink" href="#case" title="Link to this heading"></a></h4>
<p>Another option to handle flow, instead of nested <em>ifs</em>, is <code class="docutils literal notranslate"><span class="pre">case</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>read -p &quot;Do you want to create a directory (y/n)? &quot; yesno   # expects user input
case $yesno in
  y|yes)
    dir=&#39;dirname&#39;
    echo Creating a new directory $dir
    mkdir $dir
    cd $dir
    ;;
  n|no)
    echo Proceeding in the current dir $(pwd)
    ;;
  *)
    echo Invalid response
    exit 1
    ;;
esac
# $yesno can be replaced with ${yesno,,} to convert to a lower case on the fly
</pre></div>
</div>
<p><strong>In the example above, we introduce</strong> <code class="docutils literal notranslate"><span class="pre">read</span></code>, a built-in command that reads one line from the standard
input or file descriptor.</p>
<p><code class="docutils literal notranslate"><span class="pre">case</span></code> tries to match the variable against each pattern in turn. Understands patterns rules like <code class="docutils literal notranslate"><span class="pre">*,</span> <span class="pre">?,</span> <span class="pre">[],</span> <span class="pre">|</span></code>.</p>
<p>Here is the <em>case</em> that could be used as an idea for your <em>~/.bashrc</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>host=$(hostname)
case $host in
  myworkstation*)
    export PRINTER=mynearbyprinter
    # making your promt smiling when exit code is 0 :)
    PS1=&#39;$(if [[ $? == 0 ]]; then echo &quot;\[\e[32m\]:)&quot;; else echo &quot;\[\e[31m\]:(&quot;; fi)\[\e[0m\] \u@\h \w $ &#39;
  ;;
  triton*)
    [[ -n $WRKDIR ]] &amp;&amp; alias cwd=&quot;cd $WRKDIR&quot; &amp;&amp; cwd
  ;;
  kosh*|brute*|force*)
    PS1=&#39;\u@\h:\w\$&#39;
    export IGNOREEOF=0
  ;&amp;
  *.aalto.fi)
    kinit
  ;;
  *)
    echo &#39;Where are you?&#39;
  ;;
esac
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">;;</span></code> is important, if replaced with <code class="docutils literal notranslate"><span class="pre">;&amp;</span></code>, execution will continue with the command
associated with the next pattern, without testing it. <code class="docutils literal notranslate"><span class="pre">;;&amp;</span></code> causes the shell to test
next pattern. The default behaviour with <code class="docutils literal notranslate"><span class="pre">;;</span></code> is to stop matches after first pattern
has been found.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a file &#39;cx&#39;</span>
<span class="k">case</span> <span class="s2">&quot;$0&quot;</span> <span class="ow">in</span>
 <span class="o">*</span><span class="n">cx</span><span class="p">)</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="s2">&quot;$@&quot;</span> <span class="p">;</span><span class="o">&amp;</span>
 <span class="o">*</span><span class="n">cw</span><span class="p">)</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">w</span> <span class="s2">&quot;$@&quot;</span> <span class="p">;;</span>
 <span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="n">chmod</span> <span class="o">-</span><span class="n">w</span> <span class="s2">&quot;$@&quot;</span> <span class="p">;;</span>
 <span class="o">*</span><span class="p">)</span> <span class="n">echo</span> <span class="s2">&quot;$0: seems that file name is somewhat different&quot;</span><span class="p">;</span> <span class="n">exit</span> <span class="mi">1</span> <span class="p">;;</span>
<span class="n">esac</span>

<span class="c1"># chmod +x cx</span>
<span class="c1"># ln cx cw</span>
<span class="c1"># ln cx c-w</span>
<span class="c1"># to make a file executable &#39;cx filename&#39;</span>
</pre></div>
</div>
<p>The following example is useful for Triton users: <a class="reference external" href="https://scicomp.aalto.fi/triton/tut/array.html">array jobs</a>,
where one handles array subtasks based on its index.</p>
</section>
<section id="exercise-2-3">
<h4>Exercise 2.3<a class="headerlink" href="#exercise-2-3" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Re-implement the above mentioned example
<code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">[[</span> <span class="pre">-d</span> <span class="pre">$d</span> <span class="pre">&amp;&amp;</span> <span class="pre">!</span> <span class="pre">$(echo</span> <span class="pre">$PATH|grep</span> <span class="pre">$d)</span> <span class="pre">]]</span> <span class="pre">...</span></code> with the matching operator <code class="docutils literal notranslate"><span class="pre">=~</span></code></p></li>
<li><p>Improve the <code class="docutils literal notranslate"><span class="pre">tarit.sh</span></code> script we developed recently:</p>
<ul>
<li><p>add check for the number of the given arguments. Hint: <code class="docutils literal notranslate"><span class="pre">$#</span></code> must be zero or one.</p></li>
<li><p>validate the given path like <em>path/to/file</em>. Hint: <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">$d</span> <span class="pre">=~</span> <span class="pre">regexpr</span> <span class="pre">]]</span></code>,
the path may have only alphanumeric symbols, dots, underscore and slashes as
a directory delimiter.</p></li>
</ul>
</li>
<li><p>Expand <code class="docutils literal notranslate"><span class="pre">cx</span></code> script:</p>
<ul>
<li><p>check that $&#64; not empty</p></li>
<li><p>add option for <code class="docutils literal notranslate"><span class="pre">cr</span></code> that would add read rights for all. Hint: <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">a+r</span> <span class="pre">...</span></code></p></li>
</ul>
</li>
<li><p>(*) Write a function (add to <em>bin/functions</em>) that validates an IPv4 using
<code class="docutils literal notranslate"><span class="pre">=~</span></code> matching operator. The function should fail incorrect IPs like 0.1.2.3d
or 233.204.3.257. The problem should be solved with the regular expression only.
Use <code class="docutils literal notranslate"><span class="pre">return</span></code> command to exit with the right exit code.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-loops"></span><section id="loops">
<h3>Loops<a class="headerlink" href="#loops" title="Link to this heading"></a></h3>
<section id="arithmetic">
<h4>Arithmetic<a class="headerlink" href="#arithmetic" title="Link to this heading"></a></h4>
<p>BASH works with integers only (no floating point) but supports wide range of arithmetic operators using
arithmetic expansion <code class="docutils literal notranslate"><span class="pre">$((</span> <span class="pre">expression</span> <span class="pre">))</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>All tokens in the expression undergo parameter and variable expansion, command substitution,
and quote removal. The result is treated as the arithmetic expression to be evaluated.</p></li>
<li><p>Arithmetic expansion may be nested.</p></li>
<li><p>Variables inside double parentheses can be without a $ sign.</p></li>
<li><p>BASH has other options to work with the integers, like <code class="docutils literal notranslate"><span class="pre">let</span></code>, <code class="docutils literal notranslate"><span class="pre">expr</span></code>, <code class="docutils literal notranslate"><span class="pre">$[]</span></code>, and in
older scripts/examples you may see them.</p></li>
</ul>
</div></blockquote>
<p>Available operators:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n++</span></code>, <code class="docutils literal notranslate"><span class="pre">n--</span></code>, <code class="docutils literal notranslate"><span class="pre">++n</span></code>, <code class="docutils literal notranslate"><span class="pre">--n</span></code> increments/decrements</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code> plus minus</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">**</span></code> exponent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> multiplication, (truncating) division, remainder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">||</span></code> logical AND, OR</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expr?expr:expr</span></code> conditional operator (ternary)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> comparison</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>, <code class="docutils literal notranslate"><span class="pre">%=</span></code> assignment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">()</span></code>  sub-expressions in parentheses  are  evaluated first</p></li>
<li><p>The full list includes bitwise operators, see <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">bash</span></code> section <em>ARITHMETIC EVALUATION</em>.</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># without dollar sing value is not returned, though &#39;n&#39; has been incremented
n=10; ((n++))

# but if we need a value
n=10; m=3; q=$((n**m))

# here we need exit code only
if ((q%2)); then echo odd; fi
if ((n&gt;=m)); then ...; fi

# condition ? integer_value_if_true : integer_value_if_false
n=2; m=3; echo $((n&lt;m?10:100))

# checking number of input parameters, if $# is zero, then exit
# (though the alternative [[ $# == 0 ]] is more often used, and intuitively more clear)
if ! (($#)); then echo Usage: $0 argument; exit1; fi
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># sum all numbers from 1..n, where n is a positive integer
# Gauss method, summing pairs
if (($#==1)); then
  n=$1
else
  read -p &#39;Give me a positive integer &#39; n
fi
echo Sum from 1..$n is $((n*(n+1)/2))
</pre></div>
</div>
<p>Left for the exercise: make a summation directly 1+2+3+…+n and compare performance with the above one.</p>
<p>For anything more mathematical than summing integers, one should use something else,
one of the option is <code class="docutils literal notranslate"><span class="pre">bc</span></code>, often installed by default.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># bc -- an arbitrary precision calculator language</span>
<span class="c1"># compute Pi number</span>
<span class="n">echo</span> <span class="s2">&quot;scale=10; 4*a(1)&quot;</span> <span class="o">|</span> <span class="n">bc</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>A way to get percentage with the floating point</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">done</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="n">total</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span> <span class="n">printf</span> <span class="s2">&quot;</span><span class="si">%.2f%%</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;$((10**3*100*done/total))e-3&quot;</span>
</pre></div>
</div>
</section>
<section id="for-loops">
<h4>For loops<a class="headerlink" href="#for-loops" title="Link to this heading"></a></h4>
<p>BASH offers several options for iterating over the lists of elements. The options include</p>
<blockquote>
<div><ul class="simple">
<li><p>Basic construction <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">arg</span> <span class="pre">in</span> <span class="pre">item1</span> <span class="pre">item2</span> <span class="pre">item3</span> <span class="pre">...</span></code></p></li>
<li><p>C-style <em>for loop</em> <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">((i=1;</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">LIMIT</span> <span class="pre">;</span> <span class="pre">i++))</span></code></p></li>
<li><p>while and until constructs</p></li>
</ul>
</div></blockquote>
<p>Simple loop over a list of items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># note that if you put &#39;list&#39; in quotes it will be considered as one item
for dir in dir1 dir2 dir3/subdir1; do
  echo &quot;Archiving $dir ...&quot;
  tar -caf ${dir//\/.}.tar.gz $dir &amp;&amp; rm -rf $dir
done
</pre></div>
</div>
<p>If path expansions used (*, ?, [], etc), loop automatically lists current directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># example below uses ImageMagick&#39;s utlity to convert all *.jpg files
# in the current directory to *.png.
# i.e. &#39;*.jpg&#39; similar to &#39;ls *.jpg&#39;
for f in *.jpg; do
 convert &quot;$f&quot; &quot;${f/.jpg/.png}&quot;   # quotes to avoid issues with the spaces in the name
done

# another command line example renames *.JPG and *.JPEG files to *.jpg
# note: in reality one must check that a newly created *.jpg file does not exist
for f in *.JPG *JPEG; do mv -i &quot;$f&quot; &quot;${f/.*/.jpg}&quot;; done

# do ... done in certain contexts, can be omitted by framing the command block within curly brackets
# and certain for loop can be written in one line as well
for i in {1..10}; { echo i is $i; }
</pre></div>
</div>
<p>If <em>in list</em> omitted, <em>for</em> loop goes through script/function input parameters <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># here is a loop to rename files which names are given as input parameters</span>
<span class="c1"># touch file{1..3}; ./newname file1 file2 file3</span>
<span class="k">for</span> <span class="n">old</span><span class="p">;</span> <span class="n">do</span>
  <span class="n">read</span> <span class="o">-</span><span class="n">p</span> <span class="s2">&quot;old name $old, new name: &quot;</span> <span class="n">new</span>
  <span class="n">mv</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;$old&quot;</span> <span class="s2">&quot;$new&quot;</span>
<span class="n">done</span>
</pre></div>
</div>
<p>Note: as side note, while working with the files/directories, you will find lots of examples where
loops can be emulated by <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">...</span> <span class="pre">-print0</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">-0</span> <span class="pre">...</span></code> pipe.</p>
<p>Loop output can be piped or redirected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># loop other all users (on a server) to find out who has logged in within last month
for u in $(getent group triton-users | cut -d: -f4 | tr &#39;,&#39; &#39; &#39;); do
  echo $u: $(last -Rw -n 1 $u | head -1)
done | sort &gt; filename
</pre></div>
</div>
<p>The <em>list</em> can be anything what produces a list, like Brace expansion <em>{1..10}</em>, command substitution etc.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># on Triton, do something to all pending jobs based on squeue output
for jobid in $(squeue -h -u $USER -t PD -o %A); do
  scontrol update JobId=$jobid StartTime=now+5days
done

# using find to make a list of files to deal with; the benefit here is that you work
# with the filename as a variable, which gives you flexibility as comparing to
# &#39;find ... -exec {}&#39; or &#39;find ... print0 | xargs -0 ...&#39;
for f in $(find . -type f -name &#39;*.sh&#39;); do
  if ! bash -n $f &amp;&gt;/dev/null; then
    mv $f ${f/.sh/.fixme.sh}
  fi
done
</pre></div>
</div>
<p>C-style, expressions evaluated according to the arithmetic evaluation rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="o">=</span><span class="mi">10</span>
<span class="k">for</span> <span class="p">((</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">))</span>  <span class="c1"># LIMIT with no $</span>
<span class="n">do</span>
  <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;$i &quot;</span>
<span class="n">done</span>
</pre></div>
</div>
<p>Loops can be nested.</p>
</section>
<section id="while-until-loops">
<h4>While/until loops<a class="headerlink" href="#while-until-loops" title="Link to this heading"></a></h4>
<p>Other useful loop statement are <code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">until</span></code>. Both execute continuously as long as the
condition returns exit status zero/non-zero correspondingly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>while condition; do
  command1
  command2
  ...
done

# sum of all numbers 1..n; n expected as an argument
n=$1 i=1
until ((i &gt; n)); do
  ((s+=i)); ((i++))
done
echo Sum of 1..$n is $s

# endless loop, can be stopped with Ctrl-c or killed
# drop an email every 10 minutes about running jobs on Triton
# can be used in combination with &#39;screen&#39;, and run in background
while true; do
  squeue -t R -u $USER | mail -s &#39;running jobs&#39; mister.x@aalto.fi
  sleep 600
done

# with the help of &#39;read var&#39; passes file line by line,
# IFS= variable before read command to prevent leading/trailing
# whitespace from being trimmed
input=&#39;/path/to/txt/file&#39;
while IFS= read -r line; do
 echo $line
done &lt; &quot;$input&quot;

# reading file fieldwise, IFS= is a delimiter, note quoting with \
file=&#39;/path/to/file.csv&#39;
while IFS=\; read -r f1 f2 f3 f4; do
  printf &#39;Field1: %s, Field2: %s, Field4: %s\n&#39; &quot;$f1&quot; &quot;$f2&quot; &quot;$f4&quot;
done &lt; &quot;$file&quot;

# process substitution
while IFS= read -r line; do
  # do something with the lines
done &lt; &lt;(file -b *)
# instead, one can mistakenly try &#39;file -b * | while read line; do ... done&#39;
# with pipe, &#39;while&#39; body will be run in a subshell, and thus all variables
# used inside the loop will die when loop is over
</pre></div>
</div>
<p>All the things mentioned above for <em>for</em> loop applicable to <code class="docutils literal notranslate"><span class="pre">while</span></code> / <code class="docutils literal notranslate"><span class="pre">until</span></code> loops.</p>
<dl class="simple">
<dt><em>printf</em> should be familiar to programmers, allows formatted output</dt><dd><p>similar to C printf. <a class="footnote-reference brackets" href="#printf" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
</dd>
</dl>
</section>
<section id="loop-control">
<h4>Loop control<a class="headerlink" href="#loop-control" title="Link to this heading"></a></h4>
<p>Normally <em>for</em> loop iterates until it has processed all its input arguments.
<em>while</em> and <em>until</em> loops iterate until the loop control returns a certain status. But if
needed, one can terminate loop or jump to a next iteration.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">break</span></code> terminates the loop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">continue</span></code> jump to a new iteration</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">break</span> <span class="pre">n</span></code> will terminate <em>n</em> levels of loops if they are nested, otherwise terminated only</dt><dd><p>loop in which it is embedded. Same kind of behaviour for <code class="docutils literal notranslate"><span class="pre">continue</span> <span class="pre">n</span></code>.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Even though in most of the cases you can design the code to use conditionals or alike,
<em>break</em> and <em>continue</em> certainly add the flexibility.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we expand an earlier example to avoid errors in case $f is missing/not accesible</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="o">*.</span><span class="n">JPG</span> <span class="o">*.</span><span class="n">JPEG</span><span class="p">;</span> <span class="n">do</span>
  <span class="p">[[</span> <span class="o">-</span><span class="n">r</span> <span class="s2">&quot;$f&quot;</span> <span class="p">]]</span> <span class="o">||</span> <span class="p">{</span> <span class="n">echo</span> <span class="s2">&quot;$f is missing on inaccessible&quot;</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">mv</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;$f&quot;</span> <span class="s2">&quot;${f/.*/.jpg}&quot;</span>
<span class="n">done</span>
</pre></div>
</div>
</section>
<section id="exercise-2-4">
<h4>Exercise 2.4<a class="headerlink" href="#exercise-2-4" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">d;</span> <span class="pre">do</span> <span class="pre">...</span> <span class="pre">done</span></code> expand <em>tarit.sh</em> so that it would accept multiple directories.
If no directory given, it still suppose to archive the current one.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">for</span></code> loop rename all the files in the current directory tree with the <em>.txt</em> extension to <em>.fixed.txt</em>.
Step #1: create dummy .txt files first with <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">d{1..3};</span> <span class="pre">touch</span> <span class="pre">d{1..3}/{1..3}.txt</span></code>.
Step #2: combine ‘for’ loop with ‘find’: <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">f</span> <span class="pre">in</span> <span class="pre">$(find</span> <span class="pre">.</span> <span class="pre">-name</span> <span class="pre">'*.txt');</span> <span class="pre">do</span> <span class="pre">...</span> <span class="pre">done</span></code>.</p></li>
<li><p>Use this page <code class="docutils literal notranslate"><span class="pre">while</span></code> example with <em>.cvs</em>, take the <em>demospace/Finnish_Univ_students_2018.csv</em>
to count total number of students around Finland. Tip: add checking that the number of
students field is a number <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">$totalnmb</span> <span class="pre">=~</span> <span class="pre">^[0-9]+$</span> <span class="pre">]]</span></code></p></li>
<li><p>Using built-in arithmetic write a script <em>daystill.sh</em> that counts a number of days till a
deadline (vacation/salary).
Script should take a date as an argument, where date format is <code class="docutils literal notranslate"><span class="pre">days_till</span> <span class="pre">2019-6-1</span></code>.
Tip #1: <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">-d</span> <span class="pre">GIVEN_DATE</span> <span class="pre">+&quot;%s&quot;</span></code> returns number of seconds till GIVEN_DATE since
1970-01-01 00:00:00 UTC. <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">+%s</span></code> returns seconds till now.
Tip #2: enough if you convert seconds to a number of days roughly <code class="docutils literal notranslate"><span class="pre">$((</span> <span class="pre">...</span> <span class="pre">/60/60/24))</span></code>.</p></li>
<li><p>Make script that takes a list of files and checks if there are files in there with
the spaces in the name, and if there are, rename them by replacing spaces with the underscores.
Use BASH’s builtin functionality only.</p>
<ul class="simple">
<li><p>As a study case, compare it against
<code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-depth</span> <span class="pre">-name</span> <span class="pre">'*</span> <span class="pre">*'</span> <span class="pre">-execdir</span> <span class="pre">rename</span> <span class="pre">'s/</span> <span class="pre">/_/g'</span> <span class="pre">{}</span> <span class="pre">\;</span></code></p></li>
</ul>
</li>
<li><p>Write separate scripts that count a sum of any <em>1+2+3+4+..+n</em>
sequence, both the Gauss version (see above) and summation with <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">((...))</span></code>.  Where
<em>n</em> is an argument, like <em>gauss.sh 1000</em>. Benchmark them with <code class="docutils literal notranslate"><span class="pre">time</span></code> for n=10000 or
more.</p>
<ul class="simple">
<li><p>(*) Implement both methods within one script as functions and benchmark them whithin the file</p></li>
<li><p>(*) For the direct summation one can avoid loops, how? Tip: discover <code class="docutils literal notranslate"><span class="pre">eval</span> <span class="pre">$(echo</span> <span class="pre">{1..$n})</span></code></p></li>
</ul>
</li>
<li><p>(*) Get familiar with the <code class="docutils literal notranslate"><span class="pre">getent</span></code> and <code class="docutils literal notranslate"><span class="pre">cut</span></code> utilities. Join them with a loop construction
to write a <em>mygetentgroup</em> script or just a oneliner
that generates a list of users and their real names that belong to a given group. Like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mygetentgroup group_name
meikalaj1: Jussi Meikäläinen
meikalam1: Maija Meikäläinen
...``
</pre></div>
</div>
</li>
<li><p>(*) To Aalto users: on kosh/lyta run <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">ads</span> <span class="pre">search</span> <span class="pre">samaccountname=$USER</span> <span class="pre">accountExpires</span> <span class="pre">2&gt;/dev/null</span></code>
to get your account expiration date. It is a 18-digit timestamp, the number of 100-nanoseconds
intervals since Jan 1, 1601 UTC. Implement a function that accept a user name, and if not given
uses current user by default, and then converts it to the human readable time format.
Tip: <a class="reference external" href="http://meinit.nl/convert-active-directory-lastlogon-time-to-unix-readable-time">http://meinit.nl/convert-active-directory-lastlogon-time-to-unix-readable-time</a></p>
<ul class="simple">
<li><p>Expand it to handle “Got 0 replies” response, i.e. account name not found.</p></li>
</ul>
</li>
</ul>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="printf" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://wiki.bash-hackers.org/commands/builtin/printf">https://wiki.bash-hackers.org/commands/builtin/printf</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-arrays-inputs-here-documents"></span><section id="arrays-input-here-documents">
<h3>Arrays, input, Here Documents<a class="headerlink" href="#arrays-input-here-documents" title="Link to this heading"></a></h3>
<section id="arrays">
<h4>Arrays<a class="headerlink" href="#arrays" title="Link to this heading"></a></h4>
<p>BASH supports both indexed and associative one-dimensional arrays. Indexed array can be declared
with <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-a</span> <span class="pre">array_name</span></code>, or first assignment does it automatically (note: indexed arrays only):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="o">=</span><span class="p">(</span><span class="n">my</span> <span class="n">very</span> <span class="n">first</span> <span class="n">array</span><span class="p">)</span>
<span class="n">arr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Otakaari 1&#39;</span> <span class="n">Espoo</span> <span class="mi">02150</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PL 11000&#39;</span><span class="p">)</span>
<span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">AALTO</span>
</pre></div>
</div>
<p>To access array elements (the curly braces are required, unlike normal
variable expansion):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># elements one by one
echo ${arr[0]} ${arr[1]}

# array values at once
${arr[@]}

# indexes at once
${!arr[@]}

# number of elements in the array
${#arr[@]}

# length of the element number 2
${#arr[2]}

# to append elements to the end of the array
arr+=(value)

# assign a command output to array
arr=($(command))

# emptying array
arr=()

# to destroy, delete an array
unset arr

# to unset a single array element
unset arr[6]

# sorting array
IFS=$&#39;\n&#39; sorted=($(sort &lt;&lt;&lt;&quot;${arr[*]}&quot;))

# array element inside arithmetic expanssion requires no ${}
((arr[$i]++))

# split a string like &#39;one two three etc&#39; or &#39;one,two,three,etc&#39; to an array
# note that IFS=&#39;, &#39; means that separator is either space or comma, not a sequence of them
IFS=&#39;, &#39; read -r -a arr &lt;&lt;&lt; &quot;$string&quot;

# spliting a word to an array letter by letter
word=qwerty; arr=($(echo $word | grep -o .))
</pre></div>
</div>
<p>Loops through the indexed array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in ${!arr[@]}; do
  echo arr[$i] is ${arr[$i]}
done
</pre></div>
</div>
<p>Negative index counts back from the end of the array, <em>[-1]</em> referencing to the last element.</p>
<p>Quick ways to print array with no loop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># with keys, as is
declare -p arr

# indexes -- values
echo ${!arr[@]} -- ${arr[@]}

# array elements values one per line
printf &quot;%s\n&quot; &quot;${arr[@]}&quot;
</pre></div>
</div>
<p>Passing an array to a function as an argument could be the use case when you want to make it local:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>f() {
  local arr=(${!1})    # pass $1 argument as a refence
  # do something to array elements
  echo ${arr[@]}
}

# invoke the function, huom that no changes have been done to the original arr[@]
arr=(....)
f arr[@]
</pre></div>
</div>
<p>BASH associative arrays (this type of array supported in BASH since version 4.2) needs to be
declared first (!) <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-A</span> <span class="pre">asarr</span></code>.</p>
<p>Both indexed arrays and associative can be declared as an array of integers, if all elements
values are integers <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-ia</span> <span class="pre">array</span></code> or <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-iA</span></code>. This way element values are
treated as integers always.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asarr</span><span class="o">=</span><span class="p">([</span><span class="n">university</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Aalto University&#39;</span> <span class="p">[</span><span class="n">city</span><span class="p">]</span><span class="o">=</span><span class="n">Espoo</span> <span class="p">[</span><span class="s1">&#39;street address&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Otakaari 1&#39;</span><span class="p">)</span>
<span class="n">asarr</span><span class="p">[</span><span class="n">post_index</span><span class="p">]</span><span class="o">=</span><span class="mi">02150</span>
</pre></div>
</div>
<p>Addressing is similar to indexed arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in &quot;${!asarr[@]}&quot;; do
  echo asarr[$i] is ${asarr[$i]}
done
</pre></div>
</div>
<p>Even though key can have spaces in it, quoting can be omitted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># use case: your command returns list of lines like: &#39;string1 string2&#39;
# adding them to an assoative array like: [string1]=string2
declare -A arr
for i in $(command); do
  arr+=([&quot;${i/ */}&quot;]=&quot;${i/* /}&quot;)
done
</pre></div>
</div>
<p>Variable expanssions come out in the new light:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># this will return two elements of the array starting from number 1
${arr[@]:1:2}

# all elements without last one
${arr[@]:0:${#arr[@]}-1}

# parts replacement will be applied to all array elements
declare -A emails=([Vesa]=vesa@aalto.fi [Kimmo]=kimmo@helsinki.fi [Anna]=anna@math.tut.fi)
echo ${emails[@]/@*/@gmail.com}
# returns: vesa@gmail.com anna@gmail.com kimmo@gmail.com
</pre></div>
</div>
<p>For a sake of demo: let us count unique users and their occurances (yes, one can do it with ‘uniq -c’ :)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># declare assoative array of integers
declare -iA arr

for i in $(w -h | cut -c1-8); do   # get list of currenly logged users into loop
  for u in ${!arr[@]}; do   # check that they are unique
    if [[ $i == $u ]]; then
      ((arr[$i]++))
      continue 2
    fi
  done
  arr[$i]=1  # if new, add a new array element
done

for j in ${!arr[@]}; do    # printing out
  echo ${arr[$j]} $j
done
</pre></div>
</div>
<p>Another working demo: script that automates backups or just makes a sync of data to a remote server.
Same can be adapted to copy locally, to a usb drive or alike.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># array of directories to be backuped, to skip one, just comment with #
declare -A dirs
dirs[wlocal]=/l/$USER
dirs[xpproject]=/m/phys/extra/project/xp
dirs[homebin]=$HOME/bin

cmd=&#39;/usr/bin/rsync&#39;                   # rsync
args=&quot;-auvW --delete --progress $@&quot;    # accept extra args, like &#39;-n&#39; for the dryrun first
serv=&#39;user@server:backups&#39;             # copying to ~/backups that must exist

# array key is used for the remote dir name
for d in ${!dirs[@]}; do
  echo &quot;Syncing ${dirs[$d]}...&quot;
  $cmd $args ${dirs[$d]}/ $serv/$d
done
</pre></div>
</div>
</section>
<section id="exercise-2-5">
<h4>Exercise 2.5<a class="headerlink" href="#exercise-2-5" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>make a script/function that produces an array of random numbers, make sure that numbers
are unique. Print the array nicely using <code class="docutils literal notranslate"><span class="pre">printf</span></code> for formating.</p>
<ul>
<li><p>one version should use BASH functionality only (Tip: <code class="docutils literal notranslate"><span class="pre">$RANDOM</span></code>)</p></li>
<li><p>the other one can use <code class="docutils literal notranslate"><span class="pre">shuf</span></code></p></li>
</ul>
</li>
<li><p>(*) Pick up the <code class="docutils literal notranslate"><span class="pre">ipvalid</span></code> function that we have developed earlier, implement IP matching
regular expression as <code class="docutils literal notranslate"><span class="pre">^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$</span></code> and
work with the ${BASH_REMATCH[*]} array to make sure that all numbers are in the range 0-255</p></li>
</ul>
</div>
</section>
<section id="working-with-the-input">
<h4>Working with the input<a class="headerlink" href="#working-with-the-input" title="Link to this heading"></a></h4>
<p>User input can be given to a script in three ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>as command arguments, like <code class="docutils literal notranslate"><span class="pre">./script.sh</span> <span class="pre">arg1</span> <span class="pre">arg2</span> <span class="pre">...</span></code></p></li>
<li><p>interactively from keyboard with <code class="docutils literal notranslate"><span class="pre">read</span></code> command</p></li>
<li><p>as standard input, like <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">|</span> <span class="pre">./script</span></code></p></li>
</ul>
</div></blockquote>
<p>Nothing stops from using a combination of them or all of the approaches in one script.
Let us go through the last two first and then get back to command line arguments.</p>
<p><code class="docutils literal notranslate"><span class="pre">read</span></code> can do both: read from keyboard or from STDIN</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># the command prints the prompt, waits for the response, and then assigns it</span>
<span class="c1"># to variable(s)</span>
<span class="n">read</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;Your names: &#39;</span> <span class="n">firstn</span> <span class="n">lastn</span>

<span class="c1"># read into array, each word as a new array element (&#39;arr&#39; declared automatically)</span>
<span class="n">read</span> <span class="o">-</span><span class="n">a</span> <span class="n">arr</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;Your names: &#39;</span>
</pre></div>
</div>
<p>Given input must be checked (!) with a pattern, especially if script creates directories,
removes files, sends emails based on the input.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># request a new directory name till correct one is given (interrupt with Ctrl-C)
regexp=&#39;^[a-zA-Z0-9/_-]+$&#39;
until [[ &quot;$newdir&quot; =~ $regexp ]]; do
  read -p &#39;New directory: &#39; newdir
done
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read</span></code> selected options</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-a</span> <span class="pre">&lt;ARRAY&gt;</span></code>  read the data word-wise into the specified array &lt;ARRAY&gt; instead of normal variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span> <span class="pre">&lt;NCHARS&gt;</span></code> reads &lt;NCHARS&gt; characters of input, ignoring any delimiter, then quits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">&lt;PROMPT&gt;</span></code> the prompt string &lt;PROMPT&gt; is output (without a trailing automatic newline) before the read is performed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span></code>  raw input - disables interpretion of backslash escapes and line-continuation in the read data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span></code> secure input - don’t echo input if on a terminal (passwords!)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">&lt;TIMEOUT&gt;</span></code> wait for data &lt;TIMEOUT&gt; seconds, then quit (exit code 1)</p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">read</span></code> is capable of reading STDIN, case like <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">|</span> <span class="pre">./script</span></code>, with <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">read</span> <span class="pre">var</span></code> it goes
through the input line by line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># IFS= is empty and echo argument in quotes to make sure we keep the format</span>
<span class="c1"># otherwise all spaces and new lines shrinked to one and leading/trailing whitespace trimmed</span>
<span class="k">while</span> <span class="n">IFS</span><span class="o">=</span> <span class="n">read</span> <span class="o">-</span><span class="n">r</span> <span class="n">line</span><span class="p">;</span> <span class="n">do</span>
  <span class="n">echo</span> <span class="s2">&quot;line is $line&quot;</span>    <span class="c1"># do something useful with $line</span>
<span class="n">done</span>

<span class="c1"># To check current $IFS</span>
<span class="n">cat</span> <span class="o">-</span><span class="n">A</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;$IFS&quot;</span>
</pre></div>
</div>
<p>Though in general, whatever comes from STDIN can be proceeded as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># to check that STDIN is not empty</span>
<span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">stdin</span> <span class="p">]];</span> <span class="n">then</span>
  <span class="c1"># passing STDIN to a pipeline  (/dev/stdin can be omitted)</span>
  <span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">stdin</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span><span class="s1">&#39; &#39;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">|</span> <span class="n">sort</span>
<span class="n">fi</span>
</pre></div>
</div>
<p>Other STDIN tricks that one can use in the scripts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># to read STDIN to a variable, both commands do the same
var=$(&lt;/dev/stdin)
var=$(cat)
</pre></div>
</div>
<p>In the simplest cases like <code class="docutils literal notranslate"><span class="pre">./script</span> <span class="pre">arg1</span> <span class="pre">arg2</span> <span class="pre">...</span></code>, you check <em>$#</em> and then assign
<em>$1, $2, …</em> the way your script requires.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># here we require exactly two arguments
if (($#==2)); then
  var1=$1 var2=$2
  # ... do something useful
else
  echo &#39;Wrong amount of arguments&#39;
  echo &quot;Usage: ${0##*/} arg1 arg2&quot;
  exit 1
fi
</pre></div>
</div>
<p>To work with all input arguments at once we have <em>$&#64;</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># $# is a number of arguments on the command line, must be non-zero
if (($#)); then
  for i; do
    echo &quot;$i&quot;
    # ... do something useful with each element of $@
    # note that &#39;for ...&#39; uses $@ by default if no other list given with &#39;in ...&#39;
  done
else
  echo &#39;No command line arguments given&#39;
fi
</pre></div>
</div>
<p>As a use case, our <em>tarit.sh</em> script. The script can accept STDIN and
arguments, so we check both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Usage: tarit.sh [dirname1 [dirname2 [dirname3 ...]]]
# or     command | tarit.sh

# by default no directories to archive. i.e. current
args=&#39;&#39;

# checking for STDIN, if any, assigning STDIN to $args
[[ -p /dev/stdin ]] &amp;&amp; args=$(&lt;/dev/stdin)

# if arguments are given, appending the $args with $@
(($#)) &amp;&amp; args+=&quot; $@&quot;

# no arguments, no stdin, then it is a current dir
[[ -z &quot;$args&quot; ]] &amp;&amp; args=&quot;$(pwd)&quot;

# by now we should have a directory list in $args to archive
for d in $args; do
  # checking that directory exists, if so, archive it
  if [[ -d &quot;$d&quot; ]]; then
    echo Archiving $d ...
    tar caf ${d##*/}.$(date +%Y-%m-%d).tar.gz &quot;$d&quot;
  else
    echo &quot;   $d does not exist, skipping.&quot;
  fi
done
</pre></div>
</div>
<p>Often, the above mentioned ways are more than enough for simple scripts.
But what if options and arguments are like
<code class="docutils literal notranslate"><span class="pre">./script</span> <span class="pre">[-f</span> <span class="pre">filename]</span> <span class="pre">[-z]</span> <span class="pre">[-b]</span> <span class="pre">[arg1</span> <span class="pre">[arg2</span> <span class="pre">[...]]]</span></code> or more complex?
(common notaion: options in the square brackets are optional). What if you write
a production ready script that will be used by many other as well?</p>
<p>It is were <code class="docutils literal notranslate"><span class="pre">getopt</span></code> offers a more efficient way of handling script’s input options.
In the simplest case <code class="docutils literal notranslate"><span class="pre">getopt</span></code> command (do not get confused with <code class="docutils literal notranslate"><span class="pre">getopts</span></code> built-in BASH
function of similar kind) requires two parameters to work:
first is a list of valid input options – sequence of letters and colons. If letter
followed by a colon, the option requires an argument, if folowed by two colons, argument
is optional. For example, the string <code class="docutils literal notranslate"><span class="pre">getopt</span> <span class="pre">&quot;sdf:&quot;</span></code> says that the options -s, -d and -f
are valid and -f requires an argument, like <em>-f filename</em>.
The second argument required by  <em>getopt</em> is a list of input parameters (options + arguments)
to check, i.e. just <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code>.</p>
<p>Let us use <em>cx</em> script as a demo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># common usage function with the exit at the end
usage() {
  echo &quot;Usage: $sname [options] file [file [file...]]&quot;
  echo &#39;       -a, gives access to all, like a+x, by default +x&#39;
  echo &#39;       -d &lt;directory/path/bin&gt;, path to the bin directory&#39;
  echo &quot;          can be used in &#39;cx&#39; to copy a new script there&quot;
  echo &#39;       -a, gives access to all, like a+x, by default +x&#39;
  echo &#39;       -d &lt;directory/path/bin&gt;, path to the bin directory&#39;
  echo &quot;          can be used in &#39;cx&#39; to copy a new script there&quot;
  echo &#39;       -v, verbose mode for chmod&#39;
  echo &#39;       -h, this help message&#39;
  exit 1
}

# whole trick is in this part: getopt validates the input parameters,
# structures them by dividing options and arguments with --,
# and returns them to a variable
# then they are reassigned back to $@ with &#39;set --&#39;
opts=$(getopt &quot;avhd:&quot; &quot;$@&quot;) || usage
set -- $opts

# defining variables&#39; default values
ALL=&#39;&#39;
CMD=&#39;/usr/bin/chmod&#39;
sname=${0##*/}  # the name this script was called by

# by now we have a well structured $@ which we can trust.
# to go through options one by one we start an endless &#39;while&#39; loop
# with the nested &#39;case&#39;. &#39;shift&#39; makes another trick, every time
# it is invoked it is equal to &#39;unset $1&#39;, thus $@ arguments are
# &quot;shifted down&quot;, $2 becomes $1, $3 becomes $2, etc
# &#39;getopt&#39; adds -- to $@ which separates valid options and the rest
# that did not qualify, when it comes to &#39;--&#39; we &#39;break&#39; the loop
while true; do
  case ${1} in
    -h) usage ;; # output help message and exit
    -a) ALL=a ;; # if -a is given we set ALL
    -v) CMD+=&#39; -v&#39; ;; # if verbose mode required
    -d) shift # shift to take next item as a directory path for -d
        BINDIR=&quot;$1&quot;
        if [[ -z &quot;$BINDIR&quot; || ! -d &quot;$BINDIR&quot; ]]; then
          echo &quot;ERROR: the directory does not exist&quot;
          usage
        fi
     ;;
    --) shift; break ;;   # remove --
  esac
  shift
done

# script body

case &quot;$sname&quot; in
  cx*) $CMD ${ALL}+rx &quot;$@&quot; &amp;&amp; \
       [[ -n &quot;$BINDIR&quot; ]] &amp;&amp; cp -p $@ $BINDIR ;;
  cw*) $CMD ${ALL}+w &quot;$@&quot; ;;
  cr*) $CMD ${ALL}+r &quot;$@&quot; ;;
  c-w*) $CMD ${ALL}-w &quot;$@&quot; ;;
  *) echo &quot;ERROR: no idea what $sname is supposed to do&quot;; exit 1 ;;
esac
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getopt</span></code> can do way more, go for <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">getopt</span></code> for details, as an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># here is getopt sets name with &#39;-n&#39; used while reporting errors: our script name
# accepts long options like &#39;--filename myfile&#39; along with &#39;-f myfile&#39;
getopt -n $(basename $0)  -o &quot;hac::f:&quot; --long &quot;help,filename:,compress::&quot;  -- &quot;$@&quot;
</pre></div>
</div>
</section>
<section id="exercise-2-6">
<h4>Exercise 2.6<a class="headerlink" href="#exercise-2-6" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise</p>
<ul>
<li><p>Using the latest <em>tarit.sh</em> (see lecture notes) version as an example,
expand above <em>cx</em> script to
accept STDIN, like <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">|</span> <span class="pre">cx</span> <span class="pre">[options]</span></code>, where <code class="docutils literal notranslate"><span class="pre">command</span></code> produces a list of
files. Example <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-t</span> <span class="pre">file</span> <span class="pre">-name</span> <span class="pre">'*.sh'</span> <span class="pre">|</span> <span class="pre">cx</span> <span class="pre">-a</span> <span class="pre">-d</span> <span class="pre">/path/to/bin</span></code>.</p></li>
<li><p>Using <em>cx</em> demo as an example, expand the latest version of our <em>tarit.sh</em>
(see lecture notes) to make it accepting the following options and arguments:
<code class="docutils literal notranslate"><span class="pre">tarit.sh</span> <span class="pre">-h</span> <span class="pre">-y</span> <span class="pre">-d</span> <span class="pre">&lt;directory/with/backups&gt;</span> <span class="pre">[dirname1</span> <span class="pre">[dirname2</span> <span class="pre">[dirname3</span> <span class="pre">...]]]</span></code>.
By default, with no args, it still should make an archive of the current directory.
<code class="docutils literal notranslate"><span class="pre">-h</span></code> returns usage info, <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">&lt;directory/path/with/backups&gt;</span></code> is a directory the
tar archives will go to, your script has to check that directory exists, the
script must also check whether a newly created archive already exist and if so, skip
creating the archive with the corresponding warning message.</p>
<blockquote>
<div><ul class="simple">
<li><p>(*) <code class="docutils literal notranslate"><span class="pre">-y</span></code> should force overwriting already existing archive.</p></li>
<li><p>(*) <code class="docutils literal notranslate"><span class="pre">-s</span></code> should make script silent, so that no errors or other messages
would come from any inline command.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</section>
<section id="here-document-placeholders">
<h4>Here Document, placeholders<a class="headerlink" href="#here-document-placeholders" title="Link to this heading"></a></h4>
<p>A ‘here document’ and ‘here string’ take the line(s) following and send them to standard
input. It’s a way to send larger blocks to stdin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># instead of &#39;echo $STRING | command ...&#39;
command &lt;&lt;&lt;$STRING

# instead of &#39;cat file | command ...&#39;
command &lt;&lt;SomeMagicStopWord
The benefit is that one can use $var, $() etc in the text
The text ends with the Stop Word on a new line, the word can be any
SomeMagicStopWord
</pre></div>
</div>
<p>Often used for messaging, be it an email or dumping bunch of text to file.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># NAME, SURNAME, EMAIL, DAYS are set earlier

mail -s &#39;Account expiration&#39; $EMAIL&lt;&lt;END-OF-EMAIL
Dear $NAME $SURNAME,

your account is about to expire in $DAYS days.

$(date)

Best Regards,
Aalto ITS
END-OF-EMAIL
</pre></div>
</div>
<p>Or just outputting to a file (same can be done with echo commands):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="n">EOF</span> <span class="o">&gt;</span><span class="n">filename</span>
<span class="o">...</span> <span class="n">text</span>
<span class="n">EOF</span>
</pre></div>
</div>
<p>One trick that is particularly useful is using this to make a long
comment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span> <span class="o">&lt;&lt;</span>\<span class="n">COMMENTS</span>
<span class="n">here</span> <span class="n">come</span> <span class="n">text</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">seen</span> <span class="n">nowhere</span>
<span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">need</span> <span class="n">to</span> <span class="n">comment</span> <span class="n">every</span> <span class="n">single</span> <span class="n">line</span> <span class="k">with</span> <span class="c1">#</span>
<span class="n">COMMENTS</span>
</pre></div>
</div>
<p><strong>Hint</strong> <code class="docutils literal notranslate"><span class="pre">&lt;&lt;\LimtiString</span></code> to turn off substitutions and place text as is with $ marks etc</p>
<p>In case you have a template file which contains variables as placeholders, replacing them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># &#39;template&#39; file like:
The name is $NAME, the email is $EMAIL

# command to substitute the placeholders and redirect to &#39;output&#39; file
# the original &#39;template&#39; file remains as is
NAME=Jussi EMAIL=jussi@gmail.com
cat template | while IFS= read -r line; do eval echo $line; done &gt; output
# resulting file: The name is Jussi, the email is jussi@gmail.com
</pre></div>
</div>
</section>
</section>
<span id="document-traps-debugging-profiling"></span><section id="traps-debugging-profiling">
<h3>Traps, debugging, profiling<a class="headerlink" href="#traps-debugging-profiling" title="Link to this heading"></a></h3>
<section id="catching-kill-signals-trap">
<h4>Catching kill signals: trap<a class="headerlink" href="#catching-kill-signals-trap" title="Link to this heading"></a></h4>
<p>What if your script generates temp file and you’d like to keep it clean
even if script gets interrupted at the execution time?</p>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">trap</span></code> command lets you tell the shell what to do if your script received
signal to exit. It can catch all, but here listed most common by their
numbers.  Note that signals are one of the common ways of communicating
with running processes in UNIX: you see these same numbers and names
in programs like <code class="docutils literal notranslate"><span class="pre">kill</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>0  EXIT  exit command</p></li>
<li><p>1  HUP   when session disconnected</p></li>
<li><p>2  INT   interrupt - often Ctrl-c</p></li>
<li><p>3  QUIT  quit - often Ctrl-</p></li>
<li><p>9  KILL  real kill command, it can’t be caught</p></li>
<li><p>15 TERM  termination, by <code class="docutils literal notranslate"><span class="pre">kill</span></code> command</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;trap&#39; catches listed signals only, others it silently ignores</span>
<span class="c1"># Usage: trap group_of_commands/function list_of_signals</span>

<span class="n">trap</span> <span class="s1">&#39;echo Do something on exit&#39;</span> <span class="n">EXIT</span>
</pre></div>
</div>
<p>Expanding the backup script from the Arrays section, this can be added to the very
beginning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interrupted</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="s1">&#39;Seems that backup has been interrupted in the middle&#39;</span>
  <span class="n">echo</span> <span class="s1">&#39;Rerun the script later to let rsync to finish its job&#39;</span>
  <span class="n">exit</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="n">trap</span> <span class="n">interrupted</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">15</span>
<span class="c1"># ... the rest of the script</span>
</pre></div>
</div>
<p>In other situation, instead of <em>echo</em>, one can come up with something else:
removing temp files, put something to the log file or output a
valuable error message to the screen.</p>
<p><strong>Hint</strong> About signals see <em>Standard signals</em> section at <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">7</span> <span class="pre">signal</span></code>. Like Ctrl-c is INT (aka SIGINT).</p>
</section>
<section id="debugging-and-profiling">
<h4>Debugging and profiling<a class="headerlink" href="#debugging-and-profiling" title="Link to this heading"></a></h4>
<p>BASH has no a debugger, but there are several ways to help with the debugging</p>
<p>Check for syntax errors without actual running it <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">-n</span> <span class="pre">script.sh</span></code></p>
<p>Or echos each command and its results with <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">-xv</span> <span class="pre">script.sh</span></code>, or even adding options directly
to the script. <code class="docutils literal notranslate"><span class="pre">-x</span></code> enables tracing during the execution, <code class="docutils literal notranslate"><span class="pre">-v</span></code> makes bash to be verbose. Both
can be set directly from the command line as above or with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-xv</span></code> inside the script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -xv</span>
</pre></div>
</div>
<p>To enable debugging for some parts of the code only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="o">+</span><span class="n">x</span>
<span class="o">...</span> <span class="n">some</span> <span class="n">code</span>
<span class="nb">set</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
<p>If you want to check quickly a few commands, with respect to how variables or other
substitutions look like, use DEBUG variable set to <em>echo</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

$DEBUG command1 $arguments
command2

# call this script like &#39;DEBUG=echo ./script.sh&#39; to see how *command1* looks like
# otherwise the script can be run as is.
</pre></div>
</div>
<p>One can also <code class="docutils literal notranslate"><span class="pre">trap</span></code> at the EXIT, this should be the very first lines in the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>end() { echo Variable Listing: a = $a  b = $b; }
trap end EXIT  # will execute end() function on exit
</pre></div>
</div>
<p>For a sake of profiling one can use PS4 and <code class="docutils literal notranslate"><span class="pre">date</span></code> (GNU version that deals with nanoseconds). PS4 is
a built in BASH variable which is printed before each command bash displays during an execution trace.
The first character of PS4 is replicated multiple times, as necessary, to indicate multiple levels
of indirection. The default is <code class="docutils literal notranslate"><span class="pre">+</span></code>. Add the lines below right after ‘#!/bin/bash’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will give you execution time of each command and its line number</span>
<span class="c1"># \011 is a tab</span>
<span class="n">PS4</span><span class="o">=</span><span class="s1">&#39;+</span><span class="se">\011</span><span class="s1">$(date &quot;+</span><span class="si">%s</span><span class="s1">.%N&quot;)</span><span class="se">\011</span><span class="s1">$</span><span class="si">{LINENO}</span><span class="se">\011</span><span class="s1">&#39;</span>
<span class="nb">set</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
<p>Optionally, if you want tracing output to be in a separate file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PS4=&#39;+\011$(date &quot;+%s.%N&quot;)\011${LINENO}\011&#39;
exec 5&gt; ${0##*/}.$$.x &amp;&amp; BASH_XTRACEFD=&#39;5&#39; &amp;&amp; set -x
</pre></div>
</div>
<p>Or to get your script looking more professional, one can enable DEBUG, i.e. tracing only
happens when you run as <code class="docutils literal notranslate"><span class="pre">DEBUG=profile</span> <span class="pre">./script.sh</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>case $DEBUG in
  profile|PROFILE|p|P)
    PS4=&#39;+\011$(date &quot;+%s.%N&quot;)\011${LINENO}\011&#39;
    exec 5&gt; ${0##*/}.$$.x &amp;&amp; BASH_XTRACEFD=&#39;5&#39; &amp;&amp; set -x ;;
esac
</pre></div>
</div>
<p>For the larger scripts with loops and functions tracing output with the date stamps and line numbers
can be summarized. For further discussion please take a look at <a class="footnote-reference brackets" href="#profiling" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="profiling" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://stackoverflow.com/questions/5014823/how-to-profile-a-bash-shell-script-slow-startup">https://stackoverflow.com/questions/5014823/how-to-profile-a-bash-shell-script-slow-startup</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-parallel-crontab-perlawksed"></span><section id="parallel-crontab-perl-awk-sed">
<h3>Parallel, crontab, perl/awk/sed<a class="headerlink" href="#parallel-crontab-perl-awk-sed" title="Link to this heading"></a></h3>
<section id="running-in-parallel-with-bash">
<h4>Running in parallel with BASH<a class="headerlink" href="#running-in-parallel-with-bash" title="Link to this heading"></a></h4>
<p>The shell doesn’t do parallelzation in the HPC way (threads, MPI), but
can run some simple commands at the same time without interaction.</p>
<p>The simplest way of parallelization is sending processes to a background and waiting in
the script till they are done.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in the script body one may run several processes, like</span>
<span class="n">command1</span> <span class="o">&amp;</span>
<span class="n">command2</span> <span class="o">&amp;</span>
<span class="n">command3</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Here is an example that can be run as <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">script</span></code> to demonstrate that execution takes
5 seconds, that is the timing of the longest chunk, and all the processes are run in
parallel and finished before script’s exit.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># trap is optional, just to be on the safe side
# at the beginning of the script, to get child processes down on exit
trap &#39;killall $(jobs -p) 2&gt;/dev/null&#39; EXIT

# dummy sleep commands groupped with echo and sent to the background
for i in 1 3 5; do
  { sleep $i; echo sleep for $i s is over; } &amp;
done

# &#39;wait&#39; makes sure jobs are done before script is finished
# try to comment it to see the difference
wait
echo THE END
</pre></div>
</div>
<p>Putting <code class="docutils literal notranslate"><span class="pre">wait</span></code> at very end of the script makes it to wait till all the child processes are
over and only then exit. Having <code class="docutils literal notranslate"><span class="pre">trap</span></code> at very beginning makes sure we kill all the process
whatever happens to the script. Otherwise they may stay running on their own even if the script has
exited.</p>
<p>Another way to run in parallel yet avoiding sending to the background is using <code class="docutils literal notranslate"><span class="pre">parallel</span></code>.
This utility runs  the  specified  command, passing it a single one of the specified arguments.
This is repeated for each argument. Jobs may be run in parallel. The default is to run one job per CPU.
If no command is specified before the <code class="docutils literal notranslate"><span class="pre">--</span></code>, the commands after it are instead run in parallel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># normally the command is passed the argument at the end of its command line. With -i</span>
<span class="c1"># option, any instances of &quot;{}&quot; in the command are replaced with the argument.</span>
<span class="n">parallel</span> <span class="n">command</span> <span class="p">{}</span> <span class="o">--</span> <span class="n">arguments_list</span>

<span class="c1"># example of making a backup with parallel rsync</span>
<span class="n">parallel</span> <span class="o">-</span><span class="n">i</span> <span class="n">rsync</span> <span class="o">-</span><span class="n">auvW</span> <span class="p">{}</span><span class="o">/</span> <span class="n">user</span><span class="nd">@server</span><span class="p">:{}</span><span class="o">.</span><span class="n">backup</span> <span class="o">--</span> <span class="n">dir1</span> <span class="n">dir2</span> <span class="n">dir3</span>

<span class="c1"># in case you want to run a command, say ten times, the arguments can be any dummy list</span>
<span class="c1"># normally parallel passes arguments at the end of the command, with &#39;-i&#39; they needs to</span>
<span class="c1"># be placed explicitly with &#39;{}&#39;, or can be skipped, like here</span>
<span class="n">parallel</span> <span class="o">-</span><span class="n">i</span> <span class="n">date</span> <span class="o">--</span> <span class="p">{</span><span class="mf">1..10</span><span class="p">}</span>

<span class="c1">#  if no command is specified before the --, the commands after it are instead run in parallel,</span>
<span class="n">parallel</span> <span class="o">--</span> <span class="n">ls</span> <span class="n">df</span> <span class="s2">&quot;echo hi&quot;</span>
</pre></div>
</div>
<p>On Triton we have installed Tollef Fog Heen’s version of parallel from <em>moreutils-parallel</em> CentOS’ RPM.
GNU project has its own though, with different syntax, but of exactly the same name, so do not get
confused.</p>
</section>
<section id="crontab">
<h4>Crontab<a class="headerlink" href="#crontab" title="Link to this heading"></a></h4>
<p>Allows run tasks automatically in the background. Users may set their own crontabs. Once crontab
task is set, it will run independently on whether you are logged in to the system or not.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-l</span></code> to list all your current cron jobs, <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> to start editor. When in, you may add
one or several lines, then save what you have added and exit the editor normally.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># run &#39;script&#39; daily at 23:30
30 23 * * * $HOME/bin/backup_script &gt; /home/user/log/backup.log 2&gt;&amp;1

# every two hours on Mon-Wed,Fri
0 /2 * * 1-3,5 rm /path/to/my/tmp/dir/* &gt;/dev/null 2&gt;&amp;1
</pre></div>
</div>
<p>The executable script could be a normal command, but crontab’s shell has quite limited functionality,
in case of anything more sofisticated than just a single command and a redirection you end up writing
a separate script.</p>
<p>The first five positions corresponds to:</p>
<blockquote>
<div><ul class="simple">
<li><p>minute (0-59)</p></li>
<li><p>hour (0-23)</p></li>
<li><p>day (1-31)</p></li>
<li><p>month (1-12)</p></li>
<li><p>day of week (0-7, 0 or 7 is Sunday)</p></li>
</ul>
</div></blockquote>
<p>Possible values are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> any value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code> value list separator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> range of values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> steps</p></li>
</ul>
</div></blockquote>
<p>You set your favorite editor:  <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">EDITOR=vim</span></code> (can be a part of ~/.bashrc).</p>
<p>As part of the crontab file you may set several environmet variables, like
<code class="docutils literal notranslate"><span class="pre">MAILTO=name.surname&#64;aalto.fi</span></code> to recieve an output from the script or any possible errors.
If <em>MAILTO</em> is defined but empty (<code class="docutils literal notranslate"><span class="pre">MAILTO=&quot;&quot;</span></code>), no mail is sent.</p>
</section>
<section id="perl-awk-sed">
<h4>Perl, awk, sed<a class="headerlink" href="#perl-awk-sed" title="Link to this heading"></a></h4>
<p>Powerful onliners. Please consult correspoding man pages and other docs for the details,
here we provide some examples. As it was standed at very beginning of the course, shell, with all its
functionality is only a glue in between all kind of utilities, like <code class="docutils literal notranslate"><span class="pre">grep</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, etc.
Perl, awk and sed are what makes terminal even more powerful. Even though Perl can do everything what
can awk and sed, one still may find tons of examples with the later ones. Here we provide some of them.</p>
<p>Python is yet another alternative.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set delimiter to : and prints the first field of each line of passwd file (user name)</span>
<span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span> <span class="s1">&#39;{print $1}&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>

<span class="c1"># sort lines by length, several ways to do it</span>
<span class="n">cat</span> <span class="n">file</span> <span class="o">|</span> <span class="n">perl</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;print sort { length($a) &lt;=&gt; length($b) } &lt;&gt;&#39;</span>
<span class="n">cat</span> <span class="n">file</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{ print length, $0 }&#39;</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">s</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span><span class="s2">&quot; &quot;</span> <span class="o">-</span><span class="n">f2</span><span class="o">-</span>

<span class="c1"># placeholders replacement example above could be</span>
<span class="n">NAME</span><span class="o">=</span><span class="n">Jussi</span> <span class="n">EMAIL</span><span class="o">=</span><span class="n">jussi</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">;</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/\$NAME/$NAME/&quot;</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/\$EMAIL/$EMAIL/&quot;</span> <span class="n">template</span>

<span class="c1"># inline word replacing in all files at once</span>
<span class="n">perl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/TKK/Aalto/g&quot;</span> <span class="o">*.</span><span class="n">html</span>
</pre></div>
</div>
</section>
<section id="about-homework-assignments">
<h4>About homework assignments<a class="headerlink" href="#about-homework-assignments" title="Link to this heading"></a></h4>
<p>Available on Triton. See details in the <em>$course_directory</em>.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-contact"></span><section id="contact">
<h3>Contact<a class="headerlink" href="#contact" title="Link to this heading"></a></h3>
<p>You can contact us via <a class="reference external" href="mailto:scip&#37;&#52;&#48;aalto&#46;fi">scip<span>&#64;</span>aalto<span>&#46;</span>fi</a>.</p>
</section>
<span id="document-about"></span><section id="about-us">
<h3>About us<a class="headerlink" href="#about-us" title="Link to this heading"></a></h3>
<p>Linux shell tutorial is a course born out of Aalto University Science-IT.</p>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-to-continue"></span><section id="to-continue-course-development-ideas-topics">
<h3>To continue: course development ideas/topics<a class="headerlink" href="#to-continue-course-development-ideas-topics" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>Additional topics:</dt><dd><ul class="simple">
<li><p>select command</p></li>
<li><p>revise coreutils section, expand the examples and explanations, make it clear
that BASH is about getting those small utilities to work together</p></li>
<li><p>benchmark: C-code vs BASH, Python vs BASH, Perl vs BASH</p></li>
</ul>
</dd>
</dl>
<section id="ideas-for-exercises">
<h4>Ideas for exercises<a class="headerlink" href="#ideas-for-exercises" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>function to find all broken links</p></li>
<li><p>(homework?) Implement a profiler, that summarizes PS4/date output mentioned above</p></li>
<li><p>(homework?) Script that makes ‘pe1 pe2 … gpu32’ out of ‘pe[1-16],gpu11,gpu32’</p></li>
</ul>
</div></blockquote>
<p>In general, there could one script that one starts building from the first line up to
a parallelization. Like backup script with rsync.</p>
<p>Git usage?</p>
</section>
</section>
<span id="document-bonus-material"></span><section id="bonus-material">
<h3>Bonus material<a class="headerlink" href="#bonus-material" title="Link to this heading"></a></h3>
<p>Parts that did not fit.</p>
<p>[FIXME: should be moved to another tutorial <em>SSH: beyond login</em>]</p>
<section id="ssh-keys-and-proxy-bonus-section">
<h4>SSH keys and proxy (<em>bonus section</em>)<a class="headerlink" href="#ssh-keys-and-proxy-bonus-section" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>SSH is the standard for connecting to remote computers: it is
both powerful and secure.</p></li>
<li><p>It is highly configurable, and doing some configuration will make
your life much easier.</p></li>
</ul>
<p>SSH keys and proxy jumping makes life way easier. For example, logging
on to Triton from your Linux workstation or from kosh/lyta.</p>
<p>For PuTTY (Windows) SSH keys generation, please consult section “Using public keys for SSH authentication” at <a class="footnote-reference brackets" href="#putty-sshkeys" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<p>On Linux/Mac: generate a key on the client machine</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">o</span>  <span class="c1"># you will be prompted for a location to save the keys, and a passphrase for the keys. Make sure passphrase is strong (!)</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">aalto_login</span><span class="nd">@triton</span><span class="o">.</span><span class="n">aalto</span><span class="o">.</span><span class="n">fi</span>   <span class="c1"># transfer file to a Triton, or/and any other host you want to login to</span>
</pre></div>
</div>
<p>From now on you should be able to login with the SSH key instead of
password. When SSH key added to the ssh-agent (once during the login
to workstation), one can login automatically, passwordless.</p>
<p>Note that same key can be used on multiple different computers.</p>
<p>SSH proxy is yet another trick to make life easier: allows to jump
through a node (in OpenSSH version 7.2 and earlier <code class="docutils literal notranslate"><span class="pre">-J</span></code> option is
not supported yet, here is an old recipe that works on Ubuntu
16.04). By using this, you can directly connect to a system (Triton)
through a jump host (kosh):  On the client side, add to
<code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file (create it if does not exists and make it
readable by you only):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">triton</span> <span class="n">triton</span><span class="o">.</span><span class="n">aalto</span><span class="o">.</span><span class="n">fi</span>
    <span class="n">Hostname</span> <span class="n">triton</span><span class="o">.</span><span class="n">aalto</span><span class="o">.</span><span class="n">fi</span>
    <span class="n">ProxyCommand</span> <span class="n">ssh</span> <span class="n">YOUR_AALTO_LOGIN</span><span class="nd">@kosh</span><span class="o">.</span><span class="n">aalto</span><span class="o">.</span><span class="n">fi</span> <span class="o">-</span><span class="n">W</span> <span class="o">%</span><span class="n">h</span><span class="p">:</span><span class="o">%</span><span class="n">p</span>
</pre></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="putty-sshkeys" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://the.earth.li/~sgtatham/putty/0.70/htmldoc/">https://the.earth.li/~sgtatham/putty/0.70/htmldoc/</a></p>
</aside>
</aside>
</section>
</section>
<span id="document-guide"></span><section id="instructor-s-guide">
<h3>Instructor’s guide<a class="headerlink" href="#instructor-s-guide" title="Link to this heading"></a></h3>
<section id="setting-up-instructions-for-the-lecturer">
<h4>Setting up instructions for the lecturer<a class="headerlink" href="#setting-up-instructions-for-the-lecturer" title="Link to this heading"></a></h4>
<p>Main terminal white&amp;black with the enlarged font size. One small terminal at the top that shows
commands to the learners.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PROMPT_COMMAND='history</span> <span class="pre">-a'</span></code>   # .bashrc or all the terminals one launches commands</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-n</span> <span class="pre">0</span> <span class="pre">-F</span> <span class="pre">.bash_history</span></code></p></li>
</ul>
</div></blockquote>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">script</span></code> allows to follow the session even after sshing to a remote host
plus command appear as soon as they are run. The
regular expression can be adapted to the lecturer’s PS1, this one assumes <em>]$ command</em>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">-f</span> <span class="pre">demos.out</span></code>   # action window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-n</span> <span class="pre">1</span> <span class="pre">-f</span> <span class="pre">demos.out</span> <span class="pre">|</span> <span class="pre">while</span> <span class="pre">read</span> <span class="pre">line;</span> <span class="pre">do</span> <span class="pre">[[</span> <span class="pre">&quot;$line&quot;</span> <span class="pre">=~</span> <span class="pre">\]\$\</span> <span class="pre">([^</span> <span class="pre">].+)$</span> <span class="pre">]]</span> <span class="pre">&amp;&amp;</span> <span class="pre">echo</span> <span class="pre">${BASH_REMATCH[1]};</span> <span class="pre">done</span></code></p></li>
</ul>
</div></blockquote>
</section>
</section>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Aalto Science-IT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>