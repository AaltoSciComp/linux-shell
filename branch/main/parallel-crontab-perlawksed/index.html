

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parallel, crontab, perl/awk/sed &mdash; Linux shell tutorial  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="aaltoscicomp.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about/" />
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Contact" href="../contact/" />
    <link rel="prev" title="Traps, debugging, profiling" href="../traps-debugging-profiling/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Linux shell tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PART #1. Linux shell basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../the-shell/">Basic shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting-commands/">Starting out</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files-and-directories/">Files and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../find/">Find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file-archive-transfer/">File archiving and transferring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_utiltities/">Command line utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines-grep/">Evaluations, separators and grep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../init_files/">Initialization files and file editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hotkeys/">How to make things faster: hotkeys</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PART #2. Linux shell scripting</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quoting-substitution-aliases/">Quoting, substitutions, aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../variables-functions-environments/">Variables, functions, environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditionals/">Conditionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loops/">Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays-inputs-here-documents/">Arrays, input, Here Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../traps-debugging-profiling/">Traps, debugging, profiling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Parallel, crontab, perl/awk/sed</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-in-parallel-with-bash">Running in parallel with BASH</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crontab">Crontab</a></li>
<li class="toctree-l2"><a class="reference internal" href="#perl-awk-sed">Perl, awk, sed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#about-homework-assignments">About homework assignments</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contact/">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/">About us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../to-continue/">To continue: course development ideas/topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bonus-material/">Bonus material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Linux shell tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Parallel, crontab, perl/awk/sed</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/content/blob/main/content/parallel-crontab-perlawksed.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="parallel-crontab-perl-awk-sed">
<h1>Parallel, crontab, perl/awk/sed<a class="headerlink" href="#parallel-crontab-perl-awk-sed" title="Link to this heading"></a></h1>
<section id="running-in-parallel-with-bash">
<h2>Running in parallel with BASH<a class="headerlink" href="#running-in-parallel-with-bash" title="Link to this heading"></a></h2>
<p>The shell doesn’t do parallelzation in the HPC way (threads, MPI), but
can run some simple commands at the same time without interaction.</p>
<p>The simplest way of parallelization is sending processes to a background and waiting in
the script till they are done.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in the script body one may run several processes, like</span>
<span class="n">command1</span> <span class="o">&amp;</span>
<span class="n">command2</span> <span class="o">&amp;</span>
<span class="n">command3</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Here is an example that can be run as <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">script</span></code> to demonstrate that execution takes
5 seconds, that is the timing of the longest chunk, and all the processes are run in
parallel and finished before script’s exit.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># trap is optional, just to be on the safe side
# at the beginning of the script, to get child processes down on exit
trap &#39;killall $(jobs -p) 2&gt;/dev/null&#39; EXIT

# dummy sleep commands groupped with echo and sent to the background
for i in 1 3 5; do
  { sleep $i; echo sleep for $i s is over; } &amp;
done

# &#39;wait&#39; makes sure jobs are done before script is finished
# try to comment it to see the difference
wait
echo THE END
</pre></div>
</div>
<p>Putting <code class="docutils literal notranslate"><span class="pre">wait</span></code> at very end of the script makes it to wait till all the child processes are
over and only then exit. Having <code class="docutils literal notranslate"><span class="pre">trap</span></code> at very beginning makes sure we kill all the process
whatever happens to the script. Otherwise they may stay running on their own even if the script has
exited.</p>
<p>Another way to run in parallel yet avoiding sending to the background is using <code class="docutils literal notranslate"><span class="pre">parallel</span></code>.
This utility runs  the  specified  command, passing it a single one of the specified arguments.
This is repeated for each argument. Jobs may be run in parallel. The default is to run one job per CPU.
If no command is specified before the <code class="docutils literal notranslate"><span class="pre">--</span></code>, the commands after it are instead run in parallel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># normally the command is passed the argument at the end of its command line. With -i</span>
<span class="c1"># option, any instances of &quot;{}&quot; in the command are replaced with the argument.</span>
<span class="n">parallel</span> <span class="n">command</span> <span class="p">{}</span> <span class="o">--</span> <span class="n">arguments_list</span>

<span class="c1"># example of making a backup with parallel rsync</span>
<span class="n">parallel</span> <span class="o">-</span><span class="n">i</span> <span class="n">rsync</span> <span class="o">-</span><span class="n">auvW</span> <span class="p">{}</span><span class="o">/</span> <span class="n">user</span><span class="nd">@server</span><span class="p">:{}</span><span class="o">.</span><span class="n">backup</span> <span class="o">--</span> <span class="n">dir1</span> <span class="n">dir2</span> <span class="n">dir3</span>

<span class="c1"># in case you want to run a command, say ten times, the arguments can be any dummy list</span>
<span class="c1"># normally parallel passes arguments at the end of the command, with &#39;-i&#39; they needs to</span>
<span class="c1"># be placed explicitly with &#39;{}&#39;, or can be skipped, like here</span>
<span class="n">parallel</span> <span class="o">-</span><span class="n">i</span> <span class="n">date</span> <span class="o">--</span> <span class="p">{</span><span class="mf">1..10</span><span class="p">}</span>

<span class="c1">#  if no command is specified before the --, the commands after it are instead run in parallel,</span>
<span class="n">parallel</span> <span class="o">--</span> <span class="n">ls</span> <span class="n">df</span> <span class="s2">&quot;echo hi&quot;</span>
</pre></div>
</div>
<p>On Triton we have installed Tollef Fog Heen’s version of parallel from <em>moreutils-parallel</em> CentOS’ RPM.
GNU project has its own though, with different syntax, but of exactly the same name, so do not get
confused.</p>
</section>
<section id="crontab">
<h2>Crontab<a class="headerlink" href="#crontab" title="Link to this heading"></a></h2>
<p>Allows run tasks automatically in the background. Users may set their own crontabs. Once crontab
task is set, it will run independently on whether you are logged in to the system or not.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-l</span></code> to list all your current cron jobs, <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> to start editor. When in, you may add
one or several lines, then save what you have added and exit the editor normally.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># run &#39;script&#39; daily at 23:30
30 23 * * * $HOME/bin/backup_script &gt; /home/user/log/backup.log 2&gt;&amp;1

# every two hours on Mon-Wed,Fri
0 /2 * * 1-3,5 rm /path/to/my/tmp/dir/* &gt;/dev/null 2&gt;&amp;1
</pre></div>
</div>
<p>The executable script could be a normal command, but crontab’s shell has quite limited functionality,
in case of anything more sofisticated than just a single command and a redirection you end up writing
a separate script.</p>
<p>The first five positions corresponds to:</p>
<blockquote>
<div><ul class="simple">
<li><p>minute (0-59)</p></li>
<li><p>hour (0-23)</p></li>
<li><p>day (1-31)</p></li>
<li><p>month (1-12)</p></li>
<li><p>day of week (0-7, 0 or 7 is Sunday)</p></li>
</ul>
</div></blockquote>
<p>Possible values are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> any value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code> value list separator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> range of values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> steps</p></li>
</ul>
</div></blockquote>
<p>You set your favorite editor:  <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">EDITOR=vim</span></code> (can be a part of ~/.bashrc).</p>
<p>As part of the crontab file you may set several environmet variables, like
<code class="docutils literal notranslate"><span class="pre">MAILTO=name.surname&#64;aalto.fi</span></code> to recieve an output from the script or any possible errors.
If <em>MAILTO</em> is defined but empty (<code class="docutils literal notranslate"><span class="pre">MAILTO=&quot;&quot;</span></code>), no mail is sent.</p>
</section>
<section id="perl-awk-sed">
<h2>Perl, awk, sed<a class="headerlink" href="#perl-awk-sed" title="Link to this heading"></a></h2>
<p>Powerful onliners. Please consult correspoding man pages and other docs for the details,
here we provide some examples. As it was standed at very beginning of the course, shell, with all its
functionality is only a glue in between all kind of utilities, like <code class="docutils literal notranslate"><span class="pre">grep</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, etc.
Perl, awk and sed are what makes terminal even more powerful. Even though Perl can do everything what
can awk and sed, one still may find tons of examples with the later ones. Here we provide some of them.</p>
<p>Python is yet another alternative.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set delimiter to : and prints the first field of each line of passwd file (user name)</span>
<span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span> <span class="s1">&#39;{print $1}&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>

<span class="c1"># sort lines by length, several ways to do it</span>
<span class="n">cat</span> <span class="n">file</span> <span class="o">|</span> <span class="n">perl</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;print sort { length($a) &lt;=&gt; length($b) } &lt;&gt;&#39;</span>
<span class="n">cat</span> <span class="n">file</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{ print length, $0 }&#39;</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">s</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span><span class="s2">&quot; &quot;</span> <span class="o">-</span><span class="n">f2</span><span class="o">-</span>

<span class="c1"># placeholders replacement example above could be</span>
<span class="n">NAME</span><span class="o">=</span><span class="n">Jussi</span> <span class="n">EMAIL</span><span class="o">=</span><span class="n">jussi</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">;</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/\$NAME/$NAME/&quot;</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/\$EMAIL/$EMAIL/&quot;</span> <span class="n">template</span>

<span class="c1"># inline word replacing in all files at once</span>
<span class="n">perl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;s/TKK/Aalto/g&quot;</span> <span class="o">*.</span><span class="n">html</span>
</pre></div>
</div>
</section>
<section id="about-homework-assignments">
<h2>About homework assignments<a class="headerlink" href="#about-homework-assignments" title="Link to this heading"></a></h2>
<p>Available on Triton. See details in the <em>$course_directory</em>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../traps-debugging-profiling/" class="btn btn-neutral float-left" title="Traps, debugging, profiling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../contact/" class="btn btn-neutral float-right" title="Contact" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Aalto Science-IT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>